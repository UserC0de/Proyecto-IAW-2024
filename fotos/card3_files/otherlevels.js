/*!
 * otherlevels - v1.20.1
 * 2020-04-21
 * HEAD / 60348955032e253ef87a0f4e60e17883b85948a2
 */


!function o(s,a,u){function c(t,e){if(!a[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[t]={exports:{}};s[t][0].call(i.exports,function(e){return c(s[t][1][e]||e)},i,i.exports,o,s,a,u)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,t,n){var r,i;r=this,i=function(){"use strict";var d,p,E;function T(e){return Array.isArray?Array.isArray(e):-1!=e.constructor.toString().indexOf("Array")}function e(e){try{var t=JSON.parse(e.data);if("object"!=typeof t||null===t)throw"malformed"}catch(e){return}var n,r,i,o=e.source,s=e.origin;if("string"==typeof t.method){var a=t.method.split("::");i=2==a.length?(n=a[0],a[1]):t.method}if(void 0!==t.id&&(r=t.id),"string"==typeof i){var u=!1;if(p[s]&&p[s][n])for(var c=0;c<p[s][n].length;c++)if(p[s][n][c].win===o){p[s][n][c].handler(s,i,t),u=!0;break}if(!u&&p["*"]&&p["*"][n])for(c=0;c<p["*"][n].length;c++)if(p["*"][n][c].win===o){p["*"][n][c].handler(s,i,t);break}}else void 0!==r&&E[r]&&E[r](s,i,t)}return d=Math.floor(1000001*Math.random()),p={},E={},window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent&&window.attachEvent("onmessage",e),{build:function(b){function y(e){if(b.debugOutput&&window.console&&window.console.log){try{"string"!=typeof e&&(e=JSON.stringify(e))}catch(e){}window.console.log("["+r+"] "+e)}}if(!window.postMessage)throw"jschannel cannot run this browser, no postMessage";if(!window.JSON||!window.JSON.stringify||!window.JSON.parse)throw"jschannel cannot run this browser, no JSON parsing/serialization";if("object"!=typeof b)throw"Channel build invoked without a proper object argument";if(!b.window||!b.window.postMessage)throw"Channel.build() called without a valid window argument";window===b.window&&y("target window is same as present window -- use at your own risk");var e,t=!1;if("string"==typeof b.origin&&("*"===b.origin?t=!0:null!==(e=b.origin.match(/^https?:\/\/(?:[-a-zA-Z0-9_\.])+(?::\d+)?/))&&(b.origin=e[0].toLowerCase(),t=!0)),!t)throw"Channel.build() called with an invalid origin";if(void 0!==b.scope){if("string"!=typeof b.scope)throw"scope, when specified, must be a string";if(1<b.scope.split("::").length)throw"scope may not contain double colons: '::'"}else b.scope="__default";function c(e,t,n){if("function"==typeof b.gotMessageObserver)try{b.gotMessageObserver(e,n)}catch(e){y("gotMessageObserver() raised an exception: "+e.toString())}if(n.id&&t){S[n.id]={};var r=(f=n.id,g=e,h=n.callbacks?n.callbacks:[],v=m=!1,{origin:g,invoke:function(e,t){if(!S[f])throw"attempting to invoke a callback of a nonexistent transaction: "+f;for(var n=!1,r=0;r<h.length;r++)if(e===h[r]){n=!0;break}if(!n)throw"request supports no such callback '"+e+"'";k({id:f,callback:e,params:t})},error:function(e,t){if(v=!0,!S[f])throw"error called for nonexistent message: "+f;delete S[f],k({id:f,error:e,message:t})},complete:function(e){if(v=!0,!S[f])throw"complete called for nonexistent message: "+f;delete S[f],k({id:f,result:e})},delayReturn:function(e){return"boolean"==typeof e&&(m=!0===e),m},completed:function(){return v}});if(_[t])try{if(n.callbacks&&T(n.callbacks)&&0<n.callbacks.length)for(var i=0;i<n.callbacks.length;i++){for(var o=n.callbacks[i],s=n.params,a=o.split("/"),u=0;u<a.length-1;u++){var c=a[u];"object"!=typeof s[c]&&(s[c]={}),s=s[c]}s[a[a.length-1]]=function(){var t=o;return function(e){return r.invoke(t,e)}}()}var l=_[t](r,n.params);r.delayReturn()||r.completed()||r.complete(l)}catch(t){var d="runtime_error",p=null;if("string"==typeof t?p=t:"object"==typeof t&&(t instanceof Error?(d=t.constructor.name,p=t.message):t&&T(t)&&2==t.length?(d=t[0],p=t[1]):"string"==typeof t.error&&(d=t.error,t.message?"string"==typeof t.message?p=t.message:t=t.message:p="")),null===p)try{void 0===(p=JSON.stringify(t))&&(p=t.toString())}catch(e){p=t.toString()}r.error(d,p)}else r.error("method_not_found","No method '"+t+"' was (yet) bound by the provider")}else n.id&&n.callback?w[n.id]&&w[n.id].callbacks&&w[n.id].callbacks[n.callback]?w[n.id].callbacks[n.callback](n.params):y("ignoring invalid callback, id:"+n.id+" ("+n.callback+")"):n.id?w[n.id]?(n.error?w[n.id].error&&w[n.id].error(n.error,n.message):void 0!==n.result?w[n.id].success(n.result):w[n.id].success(),delete w[n.id],delete E[n.id]):y("ignoring invalid response: "+n.id):t&&_[t]&&_[t]({origin:e},n.params);var f,g,h,m,v}var r=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n=0;n<5;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}(),_={},w={},S={},i=!1,o=[],s=[];function l(e){return[b.scope,e].join("::")}!function(n,e,t,r){function i(e){for(var t=0;t<e.length;t++)if(e[t].win===n)return!0;return!1}var o=!1;if("*"===e){for(var s in p)if(p.hasOwnProperty(s)&&"*"!==s&&"object"==typeof p[s][t]&&(o=i(p[s][t])))break}else p["*"]&&p["*"][t]&&(o=i(p["*"][t])),!o&&p[e]&&p[e][t]&&(o=i(p[e][t]));if(o)throw"A channel is already bound to the same window which overlaps with origin '"+e+"' and has scope '"+t+"'";"object"!=typeof p[e]&&(p[e]={}),"object"!=typeof p[e][t]&&(p[e][t]=[]),p[e][t].push({win:n,handler:r})}(b.window,b.origin,b.scope,c);var k=function(e,t){if(!e)throw"postMessage called with null message";if(t||i){if("function"==typeof b.postMessageObserver)try{b.postMessageObserver(b.origin,e)}catch(e){y("postMessageObserver() raised an exception: "+e.toString())}y("post message: "+JSON.stringify(e)+" with origin "+b.origin),b.window.postMessage(JSON.stringify(e),b.origin)}else y("queue message: "+JSON.stringify(e)),o.push(e)},a=function(e,t){var n;e=[].concat(e);for(var r=0;r<e.length;r++)t[n=e[r].toString()]=function(r){return function(e,t,n){t?u.call({method:r,params:e,success:t,error:n}):u.notify({method:r,params:e})}}(n)},u={remote:{},unbind:function(e,t){if(_[e]){if(!delete _[e])throw"can't delete method: "+e;return b.publish&&!t&&(i?u.notify({method:"__unbind",params:e}):s.push({action:"unbind",method:e})),!0}return!1},bind:function(e,t,n){if(!e||"string"!=typeof e)throw"'method' argument to bind must be string";if(!t||"function"!=typeof t)throw"callback missing from bind params";if(_[e])throw"method '"+e+"' is already bound!";return _[e]=t,b.publish&&!n&&(i?u.notify({method:"__bind",params:e}):s.push({action:"bind",method:e})),this},call:function(e){if(!e)throw"missing arguments to call function";if(!e.method||"string"!=typeof e.method)throw"'method' argument to call must be string";if(!e.success||"function"!=typeof e.success)throw"'success' callback missing from call";var i={},o=[],s=[],a=function(e,t){if(0<=s.indexOf(t))throw"params cannot be a recursive data structure";if(t&&s.push(t),"object"==typeof t)for(var n in t)if(t.hasOwnProperty(n)){var r=e+(e.length?"/":"")+n;"function"==typeof t[n]?(i[r]=t[n],o.push(r),delete t[n]):"object"==typeof t[n]&&a(r,t[n])}};a("",e.params);var t,n,r,u={id:d,method:l(e.method),params:e.params};o.length&&(u.callbacks=o),e.timeout&&(t=d,n=e.timeout,r=l(e.method),window.setTimeout(function(){if(w[t]){var e="timeout ("+n+"ms) exceeded on method '"+r+"'";w[t].error&&w[t].error("timeout_error",e),delete w[t],delete E[t]}},n)),w[d]={callbacks:i,error:e.error,success:e.success},E[d]=c,d++,k(u)},notify:function(e){if(!e)throw"missing arguments to notify function";if(!e.method||"string"!=typeof e.method)throw"'method' argument to notify must be string";k({method:l(e.method),params:e.params})},destroy:function(){!function(e,t,n){for(var r=p[t][n],i=0;i<r.length;i++)r[i].win===e&&r.splice(i,1);0===p[t][n].length&&delete p[t][n]}(b.window,b.origin,b.scope),window.removeEventListener?window.removeEventListener("message",c,!1):window.detachEvent&&window.detachEvent("onmessage",c),i=!1,_={},S={},w={},b.origin=null,o=[],y("channel destroyed"),r=""}};return u.bind("__ready",function(e,t){if(y("ready msg received"),i&&!b.reconnect)throw"received ready message while in ready state.";i=!0,r.length<6&&("publish-request"===t.type?r+="-R":r+="-L"),y("ready msg accepted."),"publish-request"===t.type&&u.notify({method:"__ready",params:{type:"publish-reply",publish:s}});for(var n=0;n<t.publish.length;n++)"bind"===t.publish[n].action?a([t.publish[n].method],u.remote):delete u.remote[t.publish[n].method];for(b.reconnect||u.unbind("__ready",!0);o.length;)k(o.splice(0,1)[0]);s=[],"function"==typeof b.onReady&&b.onReady(u)},!0),u.bind("__bind",function(e,t){a([t],u.remote)},!0),u.bind("__unbind",function(e,t){u.remote[t]&&delete u.remote[t]},!0),b.remote&&a(b.remote,u.remote),setTimeout(function(){0<r.length&&k({method:l("__ready"),params:{type:"publish-request",publish:s}},!0)},0),u}}},"object"==typeof n?t.exports=i():"function"==typeof define&&define.amd?define([],function(){return r.Channel=i()}):r.Channel=i()},{}],2:[function(e,t,n){var r,i;r=this,i=function(e,t,n){return function(e,t){"use strict";var n=t||{},r=n.aggressive||!1,i=g(n.sensitivity,20),o=g(n.timer,1e3),s=g(n.delay,0),a=n.callback||function(){},u=h(n.cookieExpire)||"",c=n.cookieDomain?";domain="+n.cookieDomain:"",l=n.cookieName?n.cookieName:"viewedOuibounceModal",d=!0===n.sitewide?";path=/":"",p=null,f=document.documentElement;function g(e,t){return void 0===e?t:e}function h(e){var t=24*e*60*60*1e3,n=new Date;return n.setTime(n.getTime()+t),"; expires="+n.toUTCString()}function m(e){e.clientY>i||(p=setTimeout(S,s))}function v(){p&&(clearTimeout(p),p=null)}setTimeout(function(){if(w())return;f.addEventListener("mouseleave",m),f.addEventListener("mouseenter",v),f.addEventListener("keydown",y)},o);var b=!1;function y(e){b||e.metaKey&&76===e.keyCode&&(b=!0,p=setTimeout(S,s))}function _(e,t){return function(){for(var e=document.cookie.split("; "),t={},n=e.length-1;0<=n;n--){var r=e[n].split("=");t[r[0]]=r[1]}return t}()[e]===t}function w(){return _(l,"true")&&!r}function S(){w()||(e&&(e.style.display="block"),a(),k())}function k(e){var t=e||{};void 0!==t.cookieExpire&&(u=h(t.cookieExpire)),!0===t.sitewide&&(d=";path=/"),void 0!==t.cookieDomain&&(c=";domain="+t.cookieDomain),void 0!==t.cookieName&&(l=t.cookieName),document.cookie=l+"=true"+u+c+d,f.removeEventListener("mouseleave",m),f.removeEventListener("mouseenter",v),f.removeEventListener("keydown",y)}return{fire:S,disable:k,isDisabled:w}}},"function"==typeof define&&define.amd?define(i):"object"==typeof n?t.exports=i():r.ouibounce=i()},{}],3:[function(e,i,o){(function(St){var e,t,n,r;e=this,t=function(){var e="object"==typeof self&&self.self===self&&self||"object"==typeof St&&St.global===St&&St||Function("return this")()||{},r=Array.prototype,s=Object.prototype,d="undefined"!=typeof Symbol?Symbol.prototype:null,i=r.push,u=r.slice,p=s.toString,o=s.hasOwnProperty,t=Array.isArray,a=Object.keys,n=Object.create,c=e.isNaN,l=e.isFinite,f=function(){};function g(e){return e instanceof g?e:this instanceof g?void(this._wrapped=e):new g(e)}var h=g.VERSION="1.10.2";function m(i,o,e){if(void 0===o)return i;switch(null==e?3:e){case 1:return function(e){return i.call(o,e)};case 3:return function(e,t,n){return i.call(o,e,t,n)};case 4:return function(e,t,n,r){return i.call(o,e,t,n,r)}}return function(){return i.apply(o,arguments)}}function v(e,t,n){return null==e?rt:Fe(e)?m(e,t,n):(We(e)&&!Be(e)?ot:it)(e)}function b(e,t){return v(e,t,1/0)}function y(e,t,n){return g.iteratee!==b?g.iteratee(e,t):v(e,t,n)}function _(i,o){return o=null==o?i.length-1:+o,function(){for(var e=Math.max(arguments.length-o,0),t=Array(e),n=0;n<e;n++)t[n]=arguments[n+o];switch(o){case 0:return i.call(this,t);case 1:return i.call(this,arguments[0],t);case 2:return i.call(this,arguments[0],arguments[1],t)}var r=Array(o+1);for(n=0;n<o;n++)r[n]=arguments[n];return r[o]=t,i.apply(this,r)}}function w(e){if(!We(e))return{};if(n)return n(e);f.prototype=e;var t=new f;return f.prototype=null,t}function S(t){return function(e){return null==e?void 0:e[t]}}function k(e,t){return null!=e&&o.call(e,t)}function E(e,t){for(var n=t.length,r=0;r<n;r++){if(null==e)return;e=e[t[r]]}return n?e:void 0}g.iteratee=b;var T=Math.pow(2,53)-1,I=S("length");function P(e){var t=I(e);return"number"==typeof t&&0<=t&&t<=T}function x(e,t,n){var r,i;if(t=m(t,n),P(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var o=ke(e);for(r=0,i=o.length;r<i;r++)t(e[o[r]],o[r],e)}return e}function C(e,t,n){t=y(t,n);for(var r=!P(e)&&ke(e),i=(r||e).length,o=Array(i),s=0;s<i;s++){var a=r?r[s]:s;o[s]=t(e[a],a,e)}return o}function D(u){return function(e,t,n,r){var i=3<=arguments.length;return function(e,t,n,r){var i=!P(e)&&ke(e),o=(i||e).length,s=0<u?0:o-1;for(r||(n=e[i?i[s]:s],s+=u);0<=s&&s<o;s+=u){var a=i?i[s]:s;n=t(n,e[a],a,e)}return n}(e,m(t,r,4),n,i)}}var j=D(1),L=D(-1);function O(e,t,n){var r=(P(e)?oe:je)(e,t,n);if(void 0!==r&&-1!==r)return e[r]}function R(e,r,t){var i=[];return r=y(r,t),x(e,function(e,t,n){r(e,t,n)&&i.push(e)}),i}function N(e,t,n){t=y(t,n);for(var r=!P(e)&&ke(e),i=(r||e).length,o=0;o<i;o++){var s=r?r[o]:o;if(!t(e[s],s,e))return!1}return!0}function M(e,t,n){t=y(t,n);for(var r=!P(e)&&ke(e),i=(r||e).length,o=0;o<i;o++){var s=r?r[o]:o;if(t(e[s],s,e))return!0}return!1}function A(e,t,n,r){return P(e)||(e=Te(e)),"number"==typeof n&&!r||(n=0),0<=ce(e,t,n)}var U=_(function(e,n,r){var i,o;return Fe(n)?o=n:Be(n)&&(i=n.slice(0,-1),n=n[n.length-1]),C(e,function(e){var t=o;if(!t){if(i&&i.length&&(e=E(e,i)),null==e)return;t=e[n]}return null==t?t:t.apply(e,r)})});function q(e,t){return C(e,it(t))}function B(e,r,t){var n,i,o=-1/0,s=-1/0;if(null==r||"number"==typeof r&&"object"!=typeof e[0]&&null!=e)for(var a=0,u=(e=P(e)?e:Te(e)).length;a<u;a++)null!=(n=e[a])&&o<n&&(o=n);else r=y(r,t),x(e,function(e,t,n){i=r(e,t,n),(s<i||i===-1/0&&o===-1/0)&&(o=e,s=i)});return o}function W(e,t,n){if(null==t||n)return P(e)||(e=Te(e)),e[st(e.length-1)];var r=(P(e)?Me:Te)(e),i=I(r);t=Math.max(Math.min(t,i),0);for(var o=i-1,s=0;s<t;s++){var a=st(s,o),u=r[s];r[s]=r[a],r[a]=u}return r.slice(0,t)}function V(s,t){return function(r,i,e){var o=t?[[],[]]:{};return i=y(i,e),x(r,function(e,t){var n=i(e,t,r);s(o,e,n)}),o}}var F=V(function(e,t,n){k(e,n)?e[n].push(t):e[n]=[t]}),H=V(function(e,t,n){e[n]=t}),J=V(function(e,t,n){k(e,n)?e[n]++:e[n]=1}),G=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;var z=V(function(e,t,n){e[n?0:1].push(t)},!0);function K(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[0]:Y(e,e.length-t)}function Y(e,t,n){return u.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function $(e,t,n){return u.call(e,null==t||n?1:t)}function Q(e,t,n,r){for(var i=(r=r||[]).length,o=0,s=I(e);o<s;o++){var a=e[o];if(P(a)&&(Be(a)||Ve(a)))if(t)for(var u=0,c=a.length;u<c;)r[i++]=a[u++];else Q(a,t,n,r),i=r.length;else n||(r[i++]=a)}return r}var X=_(function(e,t){return te(e,t)});function Z(e,t,n,r){nt(t)||(r=n,n=t,t=!1),null!=n&&(n=y(n,r));for(var i=[],o=[],s=0,a=I(e);s<a;s++){var u=e[s],c=n?n(u,s,e):u;t&&!n?(s&&o===c||i.push(u),o=c):n?A(o,c)||(o.push(c),i.push(u)):A(i,u)||i.push(u)}return i}var ee=_(function(e){return Z(Q(e,!0,!0))});var te=_(function(e,t){return t=Q(t,!0,!0),R(e,function(e){return!A(t,e)})});function ne(e){for(var t=e&&B(e,I).length||0,n=Array(t),r=0;r<t;r++)n[r]=q(e,r);return n}var re=_(ne);function ie(o){return function(e,t,n){t=y(t,n);for(var r=I(e),i=0<o?0:r-1;0<=i&&i<r;i+=o)if(t(e[i],i,e))return i;return-1}}var oe=ie(1),se=ie(-1);function ae(e,t,n,r){for(var i=(n=y(n,r,1))(t),o=0,s=I(e);o<s;){var a=Math.floor((o+s)/2);n(e[a])<i?o=a+1:s=a}return o}function ue(o,s,a){return function(e,t,n){var r=0,i=I(e);if("number"==typeof n)0<o?r=0<=n?n:Math.max(n+i,r):i=0<=n?Math.min(n+1,i):n+i+1;else if(a&&n&&i)return e[n=a(e,t)]===t?n:-1;if(t!=t)return 0<=(n=s(u.call(e,r,i),tt))?n+r:-1;for(n=0<o?r:i-1;0<=n&&n<i;n+=o)if(e[n]===t)return n;return-1}}var ce=ue(1,oe,ae),le=ue(-1,se);function de(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var o=w(e.prototype),s=e.apply(o,i);return We(s)?s:o}var pe=_(function(t,n,r){if(!Fe(t))throw new TypeError("Bind must be called on a function");var i=_(function(e){return de(t,i,n,this,r.concat(e))});return i}),fe=_(function(i,o){var s=fe.placeholder,a=function(){for(var e=0,t=o.length,n=Array(t),r=0;r<t;r++)n[r]=o[r]===s?arguments[e++]:o[r];for(;e<arguments.length;)n.push(arguments[e++]);return de(i,a,this,this,n)};return a});fe.placeholder=g;var ge=_(function(e,t){var n=(t=Q(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=pe(e[r],e)}});var he=_(function(e,t,n){return setTimeout(function(){return e.apply(null,n)},t)}),me=fe(he,g,1);function ve(e){return function(){return!e.apply(this,arguments)}}function be(e,t){var n;return function(){return 0<--e&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}var ye=fe(be,2),_e=!{toString:null}.propertyIsEnumerable("toString"),we=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function Se(e,t){var n=we.length,r=e.constructor,i=Fe(r)&&r.prototype||s,o="constructor";for(k(e,o)&&!A(t,o)&&t.push(o);n--;)(o=we[n])in e&&e[o]!==i[o]&&!A(t,o)&&t.push(o)}function ke(e){if(!We(e))return[];if(a)return a(e);var t=[];for(var n in e)k(e,n)&&t.push(n);return _e&&Se(e,t),t}function Ee(e){if(!We(e))return[];var t=[];for(var n in e)t.push(n);return _e&&Se(e,t),t}function Te(e){for(var t=ke(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}function Ie(e){for(var t={},n=ke(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t}function Pe(e){var t=[];for(var n in e)Fe(e[n])&&t.push(n);return t.sort()}function xe(u,c){return function(e){var t=arguments.length;if(c&&(e=Object(e)),t<2||null==e)return e;for(var n=1;n<t;n++)for(var r=arguments[n],i=u(r),o=i.length,s=0;s<o;s++){var a=i[s];c&&void 0!==e[a]||(e[a]=r[a])}return e}}var Ce=xe(Ee),De=xe(ke);function je(e,t,n){t=y(t,n);for(var r,i=ke(e),o=0,s=i.length;o<s;o++)if(t(e[r=i[o]],r,e))return r}function Le(e,t,n){return t in n}var Oe=_(function(e,t){var n={},r=t[0];if(null==e)return n;Fe(r)?(1<t.length&&(r=m(r,t[1])),t=Ee(e)):(r=Le,t=Q(t,!1,!1),e=Object(e));for(var i=0,o=t.length;i<o;i++){var s=t[i],a=e[s];r(a,s,e)&&(n[s]=a)}return n}),Re=_(function(e,n){var t,r=n[0];return Fe(r)?(r=ve(r),1<n.length&&(t=n[1])):(n=C(Q(n,!1,!1),String),r=function(e,t){return!A(n,t)}),Oe(e,r,t)}),Ne=xe(Ee,!0);function Me(e){return We(e)?Be(e)?e.slice():Ce({},e):e}function Ae(e,t){var n=ke(t),r=n.length;if(null==e)return!r;for(var i=Object(e),o=0;o<r;o++){var s=n[o];if(t[s]!==i[s]||!(s in i))return!1}return!0}function Ue(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var i=typeof e;return("function"==i||"object"==i||"object"==typeof t)&&function(e,t,n,r){e instanceof g&&(e=e._wrapped);t instanceof g&&(t=t._wrapped);var i=p.call(e);if(i!==p.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return d.valueOf.call(e)===d.valueOf.call(t)}var o="[object Array]"===i;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(Fe(s)&&s instanceof s&&Fe(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];var u=(n=n||[]).length;for(;u--;)if(n[u]===e)return r[u]===t;if(n.push(e),r.push(t),o){if((u=e.length)!==t.length)return!1;for(;u--;)if(!Ue(e[u],t[u],n,r))return!1}else{var c,l=ke(e);if(u=l.length,ke(t).length!==u)return!1;for(;u--;)if(c=l[u],!k(t,c)||!Ue(e[c],t[c],n,r))return!1}return n.pop(),r.pop(),!0}(e,t,n,r)}function qe(t){return function(e){return p.call(e)==="[object "+t+"]"}}var Be=t||qe("Array");function We(e){var t=typeof e;return"function"==t||"object"==t&&!!e}var Ve=qe("Arguments"),Fe=qe("Function"),He=qe("String"),Je=qe("Number"),Ge=qe("Date"),ze=qe("RegExp"),Ke=qe("Error"),Ye=qe("Symbol"),$e=qe("Map"),Qe=qe("WeakMap"),Xe=qe("Set"),Ze=qe("WeakSet");!function(){Ve(arguments)||(Ve=function(e){return k(e,"callee")})}();var et=e.document&&e.document.childNodes;function tt(e){return Je(e)&&c(e)}function nt(e){return!0===e||!1===e||"[object Boolean]"===p.call(e)}function rt(e){return e}function it(t){return Be(t)?function(e){return E(e,t)}:S(t)}function ot(t){return t=De({},t),function(e){return Ae(e,t)}}function st(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof et&&(Fe=function(e){return"function"==typeof e||!1});var at=Date.now||function(){return(new Date).getTime()},ut={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},ct=Ie(ut);function lt(t){function n(e){return t[e]}var e="(?:"+ke(t).join("|")+")",r=RegExp(e),i=RegExp(e,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,n):e}}var dt=lt(ut),pt=lt(ct);var ft=0;function gt(e){return"\\"+vt[e]}var ht=g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},mt=/(.)^/,vt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},bt=/\\|'|\r|\n|\u2028|\u2029/g;function yt(e,t){return e._chain?g(t).chain():t}function _t(n){return x(Pe(n),function(e){var t=g[e]=n[e];g.prototype[e]=function(){var e=[this._wrapped];return i.apply(e,arguments),yt(this,t.apply(g,e))}}),g}x(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var n=r[t];g.prototype[t]=function(){var e=this._wrapped;return n.apply(e,arguments),"shift"!==t&&"splice"!==t||0!==e.length||delete e[0],yt(this,e)}}),x(["concat","join","slice"],function(e){var t=r[e];g.prototype[e]=function(){return yt(this,t.apply(this._wrapped,arguments))}}),g.prototype.valueOf=g.prototype.toJSON=g.prototype.value=function(){return this._wrapped},g.prototype.toString=function(){return String(this._wrapped)};var wt=_t({default:g,VERSION:h,iteratee:b,restArguments:_,each:x,forEach:x,map:C,collect:C,reduce:j,foldl:j,inject:j,reduceRight:L,foldr:L,find:O,detect:O,filter:R,select:R,reject:function(e,t,n){return R(e,ve(y(t)),n)},every:N,all:N,some:M,any:M,contains:A,includes:A,include:A,invoke:U,pluck:q,where:function(e,t){return R(e,ot(t))},findWhere:function(e,t){return O(e,ot(t))},max:B,min:function(e,r,t){var n,i,o=1/0,s=1/0;if(null==r||"number"==typeof r&&"object"!=typeof e[0]&&null!=e)for(var a=0,u=(e=P(e)?e:Te(e)).length;a<u;a++)null!=(n=e[a])&&n<o&&(o=n);else r=y(r,t),x(e,function(e,t,n){((i=r(e,t,n))<s||i===1/0&&o===1/0)&&(o=e,s=i)});return o},shuffle:function(e){return W(e,1/0)},sample:W,sortBy:function(e,r,t){var i=0;return r=y(r,t),q(C(e,function(e,t,n){return{value:e,index:i++,criteria:r(e,t,n)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(r<n||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index}),"value")},groupBy:F,indexBy:H,countBy:J,toArray:function(e){return e?Be(e)?u.call(e):He(e)?e.match(G):P(e)?C(e,rt):Te(e):[]},size:function(e){return null==e?0:P(e)?e.length:ke(e).length},partition:z,first:K,head:K,take:K,initial:Y,last:function(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[e.length-1]:$(e,Math.max(0,e.length-t))},rest:$,tail:$,drop:$,compact:function(e){return R(e,Boolean)},flatten:function(e,t){return Q(e,t,!1)},without:X,uniq:Z,unique:Z,union:ee,intersection:function(e){for(var t=[],n=arguments.length,r=0,i=I(e);r<i;r++){var o=e[r];if(!A(t,o)){var s;for(s=1;s<n&&A(arguments[s],o);s++);s===n&&t.push(o)}}return t},difference:te,unzip:ne,zip:re,object:function(e,t){for(var n={},r=0,i=I(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},findIndex:oe,findLastIndex:se,sortedIndex:ae,indexOf:ce,lastIndexOf:le,range:function(e,t,n){null==t&&(t=e||0,e=0),n=n||(t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),o=0;o<r;o++,e+=n)i[o]=e;return i},chunk:function(e,t){if(null==t||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(u.call(e,r,r+=t));return n},bind:pe,partial:fe,bindAll:ge,memoize:function(r,i){var o=function(e){var t=o.cache,n=""+(i?i.apply(this,arguments):e);return k(t,n)||(t[n]=r.apply(this,arguments)),t[n]};return o.cache={},o},delay:he,defer:me,throttle:function(n,r,i){var o,s,a,u,c=0;function l(){c=!1===i.leading?0:at(),o=null,u=n.apply(s,a),o||(s=a=null)}function e(){var e=at();c||!1!==i.leading||(c=e);var t=r-(e-c);return s=this,a=arguments,t<=0||r<t?(o&&(clearTimeout(o),o=null),c=e,u=n.apply(s,a),o||(s=a=null)):o||!1===i.trailing||(o=setTimeout(l,t)),u}return i=i||{},e.cancel=function(){clearTimeout(o),c=0,o=s=a=null},e},debounce:function(n,r,i){function o(e,t){s=null,t&&(a=n.apply(e,t))}var s,a,e=_(function(e){if(s&&clearTimeout(s),i){var t=!s;s=setTimeout(o,r),t&&(a=n.apply(this,e))}else s=he(o,r,this,e);return a});return e.cancel=function(){clearTimeout(s),s=null},e},wrap:function(e,t){return fe(t,e)},negate:ve,compose:function(){var n=arguments,r=n.length-1;return function(){for(var e=r,t=n[r].apply(this,arguments);e--;)t=n[e].call(this,t);return t}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:be,once:ye,keys:ke,allKeys:Ee,values:Te,mapObject:function(e,t,n){t=y(t,n);for(var r=ke(e),i=r.length,o={},s=0;s<i;s++){var a=r[s];o[a]=t(e[a],a,e)}return o},pairs:function(e){for(var t=ke(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},invert:Ie,functions:Pe,methods:Pe,extend:Ce,extendOwn:De,assign:De,findKey:je,pick:Oe,omit:Re,defaults:Ne,create:function(e,t){var n=w(e);return t&&De(n,t),n},clone:Me,tap:function(e,t){return t(e),e},isMatch:Ae,isEqual:function(e,t){return Ue(e,t)},isEmpty:function(e){return null==e||(P(e)&&(Be(e)||He(e)||Ve(e))?0===e.length:0===ke(e).length)},isElement:function(e){return!(!e||1!==e.nodeType)},isArray:Be,isObject:We,isArguments:Ve,isFunction:Fe,isString:He,isNumber:Je,isDate:Ge,isRegExp:ze,isError:Ke,isSymbol:Ye,isMap:$e,isWeakMap:Qe,isSet:Xe,isWeakSet:Ze,isFinite:function(e){return!Ye(e)&&l(e)&&!c(parseFloat(e))},isNaN:tt,isBoolean:nt,isNull:function(e){return null===e},isUndefined:function(e){return void 0===e},has:function(e,t){if(!Be(t))return k(e,t);for(var n=t.length,r=0;r<n;r++){var i=t[r];if(null==e||!o.call(e,i))return!1;e=e[i]}return!!n},identity:rt,constant:function(e){return function(){return e}},noop:function(){},property:it,propertyOf:function(t){return null==t?function(){}:function(e){return Be(e)?E(t,e):t[e]}},matcher:ot,matches:ot,times:function(e,t,n){var r=Array(Math.max(0,e));t=m(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},random:st,now:at,escape:dt,unescape:pt,result:function(e,t,n){Be(t)||(t=[t]);var r=t.length;if(!r)return Fe(n)?n.call(e):n;for(var i=0;i<r;i++){var o=null==e?void 0:e[t[i]];void 0===o&&(o=n,i=r),e=Fe(o)?o.call(e):o}return e},uniqueId:function(e){var t=++ft+"";return e?e+t:t},templateSettings:ht,template:function(o,e,t){!e&&t&&(e=t),e=Ne({},e,g.templateSettings);var n,r=RegExp([(e.escape||mt).source,(e.interpolate||mt).source,(e.evaluate||mt).source].join("|")+"|$","g"),s=0,a="__p+='";o.replace(r,function(e,t,n,r,i){return a+=o.slice(s,i).replace(bt,gt),s=i+e.length,t?a+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'":n?a+="'+\n((__t=("+n+"))==null?'':__t)+\n'":r&&(a+="';\n"+r+"\n__p+='"),e}),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(e.variable||"obj","_",a)}catch(e){throw e.source=a,e}function i(e){return n.call(this,e,g)}var u=e.variable||"obj";return i.source="function("+u+"){\n"+a+"}",i},chain:function(e){var t=g(e);return t._chain=!0,t},mixin:_t});return wt._=wt},"object"==typeof o&&void 0!==i?i.exports=t():"function"==typeof define&&define.amd?define("underscore",t):(n=e._,r=t(),(e._=r).noConflict=function(){return e._=n,r})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t,n){var r=e("./v1"),i=e("./v4"),o=i;o.v1=r,o.v4=i,t.exports=o},{"./v1":7,"./v4":8}],5:[function(e,t,n){for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){var n=t||0;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}},{}],6:[function(e,t,n){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var i=new Uint8Array(16);t.exports=function(){return r(i),i}}else{var o=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},{}],7:[function(e,t,n){var g,h,m=e("./lib/rng"),v=e("./lib/bytesToUuid"),b=0,y=0;t.exports=function(e,t,n){var r=t&&n||0,i=t||[],o=(e=e||{}).node||g,s=void 0!==e.clockseq?e.clockseq:h;if(null==o||null==s){var a=m();null==o&&(o=g=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==s&&(s=h=16383&(a[6]<<8|a[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:y+1,l=u-b+(c-y)/1e4;if(l<0&&void 0===e.clockseq&&(s=s+1&16383),(l<0||b<u)&&void 0===e.nsecs&&(c=0),1e4<=c)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");b=u,h=s;var d=(1e4*(268435455&(u+=122192928e5))+(y=c))%4294967296;i[r++]=d>>>24&255,i[r++]=d>>>16&255,i[r++]=d>>>8&255,i[r++]=255&d;var p=u/4294967296*1e4&268435455;i[r++]=p>>>8&255,i[r++]=255&p,i[r++]=p>>>24&15|16,i[r++]=p>>>16&255,i[r++]=s>>>8|128,i[r++]=255&s;for(var f=0;f<6;++f)i[r+f]=o[f];return t||v(i)}},{"./lib/bytesToUuid":5,"./lib/rng":6}],8:[function(e,t,n){var s=e("./lib/rng"),a=e("./lib/bytesToUuid");t.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||s)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[r+o]=i[o];return t||a(i)}},{"./lib/bytesToUuid":5,"./lib/rng":6}],9:[function(e,F,t){(function(V){!function(){"use strict";function o(){}function i(e){var t,n=this;if(!k(n)||n._s!==s)throw D("Invalid this");if(n._s=f,e!==o){if(!E(e))throw D(m);(t=P(e)(M(n,p),M(n,d)))===y&&U(n,d,t.e)}}var s,n,r,a=null,e="object"==typeof self,u=e?self:V,t=u.Promise,c=u.process,l=Array,d=0,p=1,f=2,g="species",h="Symbol("+g+")",m="Invalid argument",v="Chaining cycle detected for promise",b="unhandledRejection",y={e:a},_=u.Symbol||{},w=e?function(e){t?new t(function(e){e()}).then(e):setTimeout(e)}:c.nextTick;function S(){return _[g]||h}function k(e){return e&&"object"==typeof e}function E(e){return"function"==typeof e}function T(e,t,n){if(!t(e))throw D(n)}function I(){try{return n.apply(r,arguments)}catch(e){return y.e=e,y}}function P(e,t){return n=e,r=t,I}function x(t,n){var r=l(t),i=0;function o(){for(var e=0;e<i;)n(r[e],r[e+1]),r[e++]=s,r[e++]=s;i=0,r.length>t&&(r.length=t)}return function(e,t){r[i++]=e,r[i++]=t,2===i&&w(o)}}function C(e,t){var n,r,i,o,s=0;if(!e)throw D(m);var a=e[_.iterator];if(E(a))r=a.call(e);else{if(!E(e.next)){if(e instanceof l){for(n=e.length;s<n;)t(e[s],s++);return s}throw D(m)}r=e}for(;!(i=r.next()).done;)if((o=P(t)(i.value,s++))===y)throw E(r.return)&&r.return(),o.e;return s}function D(e){return new TypeError(e)}(function(e,t){for(var n in t)e.prototype[n]=t[n]})(i.default=i,{then:function(e,t){if(void 0===this._s)throw D();return function(e,t,n,r){E(n)&&(t._onFulfilled=n);E(r)&&(e._uh&&O("rejectionHandled",e),t._onRejected=r);e[e._pCount++]=t,e._s!==f&&j(e,t);return t}(this,N((n=i,(r=this.constructor)&&r[S()]||n)),e,t);var n,r},catch:function(e){return this.then(s,e)},finally:function(t){return this.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){throw e})})},_pCount:0,_pre:a,_Yaku:1}),i.resolve=function(e){return R(e)?e:q(N(this),e)},i.reject=function(e){return U(N(this),d,e)},i.race=function(e){function t(e){U(i,p,e)}function n(e){U(i,d,e)}var r=this,i=N(r),o=P(C)(e,function(e){r.resolve(e).then(t,n)});return o===y?r.reject(o.e):i},i.all=function(e){var n,r=this,i=N(r),o=[];function s(e){U(i,d,e)}return(n=P(C)(e,function(e,t){r.resolve(e).then(function(e){o[t]=e,--n||U(i,p,o)},s)}))===y?r.reject(n.e):(n||U(i,p,[]),i)},P(function(){Object.defineProperty(i,S(),{get:function(){return this}})})(),i._Yaku=1;var j=x(999,function(e,t){var n,r;(r=e._s?t._onFulfilled:t._onRejected)!==s?(n=P(A)(r,e._v))!==y?q(t,n):U(t,d,n.e):U(t,e._s,e._v)}),L=x(9,function(e){!function e(t){{if(t._umark)return!0;t._umark=!0}var n,r=0,i=t._pCount;for(;r<i;)if((n=t[r++])._onRejected||e(n))return!0}(e)&&(e._uh=1,O(b,e))});function O(e,t){var n="on"+e.toLowerCase(),r=u[n];c&&c.listeners(e).length?e===b?c.emit(e,t._v,t):c.emit(e,t):r&&r({reason:t._v,promise:t})}function R(e){return e&&e._Yaku}function N(e){return R(e)?new e(o):(n=new e(function(e,t){if(n)throw D();r=e,i=t}),T(r,E),T(i,E),n);var n,r,i}function M(t,n){var r=!1;return function(e){r||(r=!0,n===p?q(t,e):U(t,n,e))}}function A(e,t){return e(t)}function U(e,t,n){var r=0,i=e._pCount;if(e._s===f)for(e._s=t,e._v=n,t===d&&L(e);r<i;)j(e,e[r++]);return e}function q(e,t){if(t===e&&t)return U(e,d,D(v)),e;if(t!==a&&(E(t)||k(t))){var n=P(B)(t);if(n===y)return U(e,d,n.e),e;E(n)?R(t)?W(e,t,n):w(function(){W(e,t,n)}):U(e,p,t)}else U(e,p,t);return e}function B(e){return e.then}function W(t,n,e){var r=P(e,n)(function(e){n&&(n=a,q(t,e))},function(e){n&&(n=a,U(t,d,e))});r===y&&n&&(U(t,d,r.e),n=a)}try{F.exports=i}catch(e){u.Yaku=i}}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],10:[function(_,w,S){!function(e){"use strict";var i=_("./services/logging"),o=_("./platform"),t=_("./services/admin"),r=_("./services/session"),s=_("./services/event"),a=_("./services/tag"),u=_("./services/notification"),c=_("./services/richinbox"),l=_("./services/push"),d=_("./services/permission"),p=_("./services/tracing"),f=_("./services/preload"),g=_("./utils");function h(t){return function(e){i.error("["+t+"] Unexpected error: "+e.message)}}function m(){this.settings={}}function v(){this.settings={}}function b(){this.settings={}}function y(e,t,n){return this.settings={},this.admin=new b,this.rims=new m,this.push=new v,this.initialize(e,t,n),this}if(m.prototype={initialize:function(e){this.settings=e},onMessagesUpdated:function(e){c.onMessagesUpdated(this.settings,e)},getNewMessages:function(e,t){c.getNewMessages(this.settings,e,t)},getMoreMessages:function(e,t){c.getMoreMessages(this.settings,e,t)},getMessages:function(e){c.getMessages(this.settings,e)},markAsRead:function(e,t){c.markAsRead(this.settings,e,t)},markAsDeleted:function(e,t){c.markAsDeleted(this.settings,e,t)}},v.prototype={initialize:function(e){this.settings=e},isSupported:function(e){l.isPushSupported(this.settings,e)},subscribe:function(e){l.subscribeToPush(this.settings,e)},unsubscribe:function(e){l.unsubscribeFromPush(this.settings,e)},isSubscribed:function(e){l.isSubscribedToPush(this.settings,e)}},b.prototype={initialize:function(e){this.settings=e},enableTracing:function(e){i.info("Executing enableTracing routine."),t.enableTracing(this.settings,e)},disableTracing:function(e){i.info("Executing disableTracing routine."),t.disableTracing(this.settings,e)},debug:function(e){i.info("Executing debug routine. Retrieving SDK configuration."),t.debug(this.settings,e)},reset:function(t){i.info("resetting OL");var n=this;r.getSessionId(this.settings)&&r.endSession(this.settings,function(){l.isSubscribedToPush(n.settings,function(e){e?l.unsubscribeFromPush(n.settings,function(){o.reset(),n.settings.data.tracking_id=null,n.settings.data.prev_tracking_id=null,n.settings.data.phash=null,n.settings.data.sid=null,i.info("OL reset complete - remember to reset your notification permissions in your browser."),t&&t()}):(o.reset(),n.settings.data.tracking_id=null,n.settings.data.prev_tracking_id=null,n.settings.data.phash=null,n.settings.data.sid=null,i.info("OL reset complete - remember to reset your notification permissions in your browser."),t&&t())})})}},y.version="1.20.1",y.environment="production",y.LOG_LEVELS=i.LOG_LEVELS,y.prototype={initialize:function(e,t,n){if(!e||0===e.length)throw new Error("OL: appKey is required!");(t=t||{}).multipleSubdomains=void 0!==t.baseDomain&&null!==t.baseDomain,o.initializeStorage(t),this.settings=_("./settings").refreshSettings(y.version,e,t,this.settings),this.admin.initialize(this.settings),this.rims.initialize(this.settings),this.push.initialize(this.settings),this.admin.initialize(this.settings),i.logLevel=this.settings.logLevel,o.initialize(this),i.info("OtherLevels initialized for ",e);var r=t.multipleSubdomains?"enabled":"disabled";i.debug("Multiple subdomain support is "+r+". Base domain is "+t.baseDomain),t.crossOriginReceiverMode&&l.setUpRemoteReceiver(),t.crossOriginReceiverMode||this.startSession(n)},startSession:function(e){var t=this.settings;r.startSession(this.settings,function(){t.preloadContent?(p.trace(t,"startSession","info","Requesting preload of interstitial(s)."),f.clearCachedInterstitials(t,function(){f.preloadInterstitials(t)})):p.trace(t,"startSession","info","Not requesting preload of interstitial(s)."),l.migrateSubscription(t),e&&e.apply(null,arguments)})},getSessionId:function(e){var t=r.getSessionId(this.settings);return e&&e(t),t},endSession:function(e){r.endSession(this.settings,e)},getAppKey:function(e){var t=this.settings.data.app_key;return e&&e(t),t},registerEvent:function(e,t,n){s.registerEvent(this.settings,e,t,n)},setTrackingId:function(e,t){var n=_("./services/tracking"),r=g.getValidTrackingId(e);if(void 0===r)throw new Error("Could not apply trackingId. Invalid trackingId supplied: "+e);var i=this.settings,o=n.getTrackingId(i),s=this;n.setTrackingId(this.settings,r,function(){if(o!==r&&(c.clear(i),l.isPushSupported(i,function(e){e&&l.isSubscribedToPush(i,function(e){e&&l.updateTrackingId(i,o,r)})}),i.preloadContent&&f.clearCachedInterstitials(i,function(){f.preloadInterstitials(i)})),t){var e=Array.prototype.slice.call(arguments,0);t.apply(s,e)}})},getTrackingId:function(e){var t=_("./services/tracking").getTrackingId(this.settings);return e&&e(t),t},setTag:function(e,t,n,r){return a.setTag(this.settings,e,t,n,r)},batchSetTag:function(e,t){return a.batchSetTag(this.settings,e,t)},getTag:function(e,t){return a.getTag(this.settings,e,t)},splitTestNotification:function(e,t,n){u.splitTestNotification(this.settings,e,t,n)},showSimpleModal:function(e,t,n,r,i){u.showSimpleModal(e,t,n,r,i)},showSplitTestAlert:function(e,t,i,o,s,a){u.splitTestNotification(this.settings,e,t,function(e,t,n){var r=i;"function"==typeof i&&(r=i(t)),u.showSimpleModal(e,r,o,function(){n(),s&&s()},function(){a&&a()})})},displayInterstitial:function(e,t,n,r,i,o){u.displayInterstitial(this.settings,e,t,n,r,i,o)},setPhash:function(e,t){r.setPhash(this.settings,e),t&&t()},askForPermission:function(e,t,n){d.askForPermission(this.settings,e,t,n)},getTraceEvents:function(e,t){var n,r;r=t?(n=e,t):e,p.readCachedTraceEvents(this.settings,n).then(r,h("getTraceEvents"))},clearTraceEvents:function(e){p.clearTraceEvents().then(e,h("clearTraceEvents"))}},void 0!==S&&(void 0!==w&&w.exports?w.exports=y:S.OtherLevels=y),void 0!==e&&e){var n=e.OtherLevelsObject||"_ol";e[n]=_("./platform/browser/driver.js")(y,e[n])}}("undefined"!=typeof window?window:null)},{"./platform":24,"./platform/browser/driver.js":11,"./services/admin":25,"./services/event":26,"./services/logging":27,"./services/notification":28,"./services/permission":29,"./services/preload":30,"./services/push":31,"./services/richinbox":32,"./services/session":33,"./services/tag":34,"./services/tracing":35,"./services/tracking":36,"./settings":37,"./utils":40}],11:[function(d,e,t){var p=d("underscore");e.exports=function(a,o){var u,c=d("../../services/logging.js");function l(){var e=arguments[0];if("function"!=typeof e){var t,n,r=Array.prototype.slice.call(arguments,1);switch(e){case"get":var i,o=d("../../utils/");return u&&(i=o.getDeep(u,r[0])),i=i||o.getDeep(a,r[0]),2===r.length&&"function"==typeof r[1]&&r[1](i),i;case"create":return void(void 0!==u?(n=r,"function"==typeof u.initialize&&u.initialize.apply(u,n)):(t=r,s.prototype=a.prototype,u=new s));default:u?function(e,t,n){for(var r,i,o=(t||"").split("."),s=0;s<o.length;s++)r=(i=i?r:e)[o[s]];return"function"==typeof r&&(r.apply(i,n),1)}(u,e,r)||c.debug("Unknown function called: '"+e+"'."):c.error("The OtherLevels object has not been initialised yet.")}}else e(l);function s(){return a.apply(this,t)}}function s(e){for(var t=0;t<e.length;t++)l.apply(l,e[t])}return function(){if(o&&o.q){var e=p.partition(o.q,function(e){return"create"===e[0]}),t=e[0],n=t.length;if(1<=n){var r=t[0];1<n&&(c.warn("'create' was called more than once during initialisation. Only the first 'create' call will be executed."),t.splice(1));var i=r[r.length-1];if("function"==typeof i)return r[r.length-1]=function(){s(e=e[1]),i()},l.apply(l,r)}s(e=p.flatten(e,!0))}}(),l}},{"../../services/logging.js":27,"../../utils/":40,underscore:3}],12:[function(e,t,n){t.exports={dispatchInternalEvent:function(e){if(window.document){var t=document.createEvent("Event");t.initEvent(e,!0,!0),document.dispatchEvent(t)}}}},{}],13:[function(e,t,n){var i=e("jschannel"),c=e("../../utils"),r=c.Promise;function o(e,t){this.url=e,this.id="ol-remote-id",this.scope=t,this._channel=null,this.timeout=1e3}function s(t,n){return function(){var e=Array.prototype.slice.call(arguments,0);return t.send(n,e)}}function a(n,r){return function(t,e){n[r].apply(n,e).then(function(e){t.complete(e)},function(e){t.error(e)}),t.delayReturn(!0)}}o.prototype._set=function(e){this._channel=e},o.prototype._get=function(e){if(null===this._channel){var t=window.document.getElementById(this.id),n=this;if(t)if(t.onload||e(new Error('"onload" method missing on iframe')),t.loaded)this._channel=i.build({window:t.contentWindow,origin:"*",scope:this.scope,reconnect:!0}),e(null,this._channel);else var r=setInterval(function(){n._channel&&(e(null,n._channel),clearInterval(r))},100);else(t=window.document.createElement("iframe")).setAttribute("src",this.url),t.setAttribute("id",this.id),t.setAttribute("visibility","hidden"),t.style="width: 0px; height: 0px; border:0px; display:none;",t.onload=function(){t.loaded=!0,n._set(i.build({window:t.contentWindow,origin:"*",scope:n.scope})),e(null,n._channel)},document.getElementsByTagName("body")[0].appendChild(t)}else e(null,this._channel)},o.prototype.send=function(s,a){var u=this;return new r(function(i,o){u._get(function(e,t){if(e)o(e);else{var n=[];for(var r in a)n.push(c.deepCopy(a[r]));t.call({method:s,params:n,success:function(e){i(e)},error:o,timeout:u.timeout})}})})},t.exports={proxySenderObject:function(e,t,n){var r={_iframeSender:new o(t,n)};for(var i in e)e.hasOwnProperty(i)&&(r[i]=s(r._iframeSender,i));return r},proxyReceiverObject:function(e,t){var n={_channel:i.build({window:window.parent,origin:"*",scope:t,reconnect:!0}),_obj:e};for(var r in e)e.hasOwnProperty(r)&&n._channel.bind(r,a(e,r))}}},{"../../utils":40,jschannel:1}],14:[function(o,e,t){var n=o("./storage.js"),s=o("./modal.js"),r=o("./push/");window.console||(window.console={});var a={_configuredStorage:null,iframeProxy:o("./iframeProxy.js"),_formatError:function(e){var t;try{t=JSON.parse(e.message)}catch(e){}return{type:"api",message:t&&t.error?t.error:e.message,url:e.url,responseJSON:t,statusCode:e.statusCode}},logger:function(){function e(e){var t=window.console[e];return function(){void 0===t.apply?t(Array.prototype.slice.call(arguments).join(" ")):t.apply(window.console,arguments)}}for(var t={log:e("log"),debug:e("log")},n=["info","warn","error","debug"],r=0;r<n.length;r++){var i=n[r];window.console[i]?t[i]=e(i):t[i]=e("log")}return t},initializeStorage:function(e){a._configuredStorage=n.getStorage(e)},initialize:function(){a.log=o("../../services/logging"),a.log.info(a._configuredStorage)},http:{_sendRequest:function(e,t,n,r,i){r||(n={payload:JSON.stringify(n)}),o("./xhr.js")[e](t,n,r,function(e){var t;if(e.responseText)try{t=JSON.parse(e.responseText)}catch(e){}t?a.log.debug("Received JSON: ",t):a.log.debug("Received text: ",e.responseText),i&&i(null,t||e.responseText)},function(e){i&&i(a._formatError(e))})},post:function(e,t,n,r){a.http._sendRequest("post",e,t,n,r)},put:function(e,t,n,r){a.http._sendRequest("put",e,t,n,r)},get:function(e,t,n,r){a.http._sendRequest("get",e,null,!0,r)},delete:function(e,t,n,r){a.http._sendRequest("delete",e,t,n,r)}},platformSettings:function(){var e=navigator.language||navigator.userLanguage,t=(new Date).getTimezoneOffset();return t=t<0?"+"+-t:"-"+t,{data:{language:e.substring(0,2),timezone:t,cookiesEnabled:navigator.cookieEnabled}}},getStoredValue:function(e){return a._configuredStorage.get(e)},setStoredValue:function(e,t,n){a._configuredStorage.set(e,t,n)},clearStoredValue:function(e){a._configuredStorage.set(e)},getPhashFromHashFragment:function(e){e=e||"phash=";var t=new RegExp(e+"(.{6,12})$"),n=t.exec(window.location.hash);return n?(window.location.hash=window.location.hash.replace(t,""),n[1]):""},showSimpleModal:function(e,t,n,r,i){new s({confirmButtonLabel:n,onConfirm:r,onDismiss:i}).show(e,t)},showEmptyModal:function(e,t,n,r){var i=new s({showConfirmButton:!1,showHeader:!1,onDismiss:r,extraClasses:e,eventHandlers:n});return i.show(t),i},applyModalTrigger:function(e,t,n){a.log.debug("applying modal trigger."),o("./modalTrigger.js").setModalTriggerStrategy(e,t,n)},push:{isSupported:r.isSupported,supportsVAPIDWebPush:r.supportsVAPIDWebPush,isHttpWebPushSupported:r.isHttpWebPushSupported,requiresDeliverabilityDelete:r.requiresDeliverabilityDelete,subscribe:function(e){return r.register(e,a._configuredStorage)},unsubscribe:function(e){return r.unregister(e,a.getBrowserName(),a._configuredStorage)},isSubscribed:function(e){return r.isRegistered(e,a._configuredStorage)},getSubscriptionDetails:function(e){return r.getSubscriptionDetails(e,a._configuredStorage)},getCurrentDeliveryDetails:function(e){return r.getCurrentDeliveryDetails(e)},saveSubscriptionDetails:function(e,t){return r.saveSubscriptionDetails(e,a._configuredStorage,t)},removeSubscriptionDetails:function(e){return r.removeSubscriptionDetails(e,a._configuredStorage)},getNotificationPermission:function(e){return r.getNotificationPermission(e,a._configuredStorage)},getLastPushMessage:r.getLastPushMessage,peekLastPushMessage:r.peekLastPushMessage,setTracingId:r.setTracingId,setTracingEnabled:r.setTracingEnabled,setTracingDisabled:r.setTracingDisabled,readTraceEvents:r.readTraceEvents,clearTraceEvents:r.clearTraceEvents,getServiceWorkerConfig:r.getServiceWorkerConfig,saveRecipientDetails:r.saveRecipientDetails},getOLParametersFromQueryString:function(e){(e=e||{}).phashParamName=e.phashParamName||"_olph",e.trackingIdParamName=e.trackingIdParamName||"_oltid",e.sessionIdParamName=e.sessionIdParamName||"_olsid";var i=Object.create(null);return window.location.search.trim().replace(/^(\?|#|&)/,"").split("&").forEach(function(e){var t=e.replace(/\+/g," ").split("="),n=t.shift(),r=0<t.length?t.join("="):void 0;n=decodeURIComponent(n),r=void 0===r?null:decodeURIComponent(r),void 0===i[n]?i[n]=r:Array.isArray(i[n])?i[n].push(r):i[n]=[i[n],r]}),{phash:i[e.phashParamName],trackingId:i[e.trackingIdParamName],sessionId:i[e.sessionIdParamName]}},getBrowserName:function(){var e=-1!==navigator.userAgent.toLowerCase().indexOf("chrome"),t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");return-1!==navigator.userAgent.toLowerCase().indexOf("safari")&&!e?"safari":window.chrome||e?"chrome":t?"firefox":void 0},getUserAgentHeader:function(){return navigator.userAgent},getOLScriptUrls:function(){var e=[];if(window.document)for(var t=document.getElementsByTagName("script"),n=0;n<t.length;n++)t[n].src&&0<t[n].src.indexOf("otherlevels")&&e.push(t[n].src);return e},reset:function(){n.reset()},dispatchInternalEvent:function(e){o("./eventDispatcher.js").dispatchInternalEvent(e)}};e.exports={logger:a.logger,initialize:a.initialize,initializeStorage:a.initializeStorage,http:{post:a.http.post,put:a.http.put,get:a.http.get,delete:a.http.delete},push:a.push,reset:a.reset,platformSettings:a.platformSettings,getStoredValue:a.getStoredValue,setStoredValue:a.setStoredValue,clearStoredValue:a.clearStoredValue,getPhashFromHashFragment:a.getPhashFromHashFragment,showSimpleModal:a.showSimpleModal,showEmptyModal:a.showEmptyModal,applyModalTrigger:a.applyModalTrigger,getOLParametersFromQueryString:a.getOLParametersFromQueryString,iframeProxy:a.iframeProxy,getBrowserName:a.getBrowserName,getUserAgentHeader:a.getUserAgentHeader,getOLScriptUrls:a.getOLScriptUrls,dispatchInternalEvent:a.dispatchInternalEvent}},{"../../services/logging":27,"./eventDispatcher.js":12,"./iframeProxy.js":13,"./modal.js":15,"./modalTrigger.js":16,"./push/":17,"./storage.js":21,"./xhr.js":23}],15:[function(e,t,n){var i=e("../../utils");function r(e){e=e||{},this._id=e.id||"ol-"+(new Date).getTime()+Math.round(100*Math.random()),this._confirmButtonLabel=e.confirmButtonLabel||"OK",this._showCloseButton=void 0===e.showCloseButton||e.showCloseButton,this._onDismiss=e.onDismiss,this._onConfirm=e.onConfirm,this._showConfirmButton=void 0===e.showConfirmButton||e.showConfirmButton,this._extraClasses=e.extraClasses||[];var r=this;e.eventHandlers&&(r._eventHandlers={},i.forEachInObject(e.eventHandlers,function(e,n){r._eventHandlers[e]=function(e){var t={};t.close=r._closeModal,n(e,t)}})),this._showModal=function(e){e.className=e.className.replace(/(?:^|\s)ol-hide(?!\S)/g,""),this._emitEvent("ol-modal-show")},this._closeModal=function(){r.close(),r=void 0},this._bindButtonClick=function(e,t,n){if(e){e.innerHTML||(e.innerHTML=t);var r=this;e.onclick=function(){r.close(),n&&n()}}},this._showHeader=void 0===e.showHeader||e.showHeader,this._bindConfirmButton=function(e){this._bindButtonClick(e,this._confirmButtonLabel,this._onConfirm)},this._bindCloseButton=function(e){this._bindButtonClick(e,"&times;",this._onDismiss)},this._attachOrRemoveEvents=function(e){if(this._eventHandlers&&this._eventHandlers!=={}){var s="attach"===e?this._addEventListener:this._removeEventListener;i.forEachInObject(this._eventHandlers,function(e,t){var n=e.split(" "),r=n[0],i=n[1],o=document.getElementById(i);o&&s(o,r,t)})}},this._attachEvents=function(){this._attachOrRemoveEvents("attach")},this._removeEvents=function(){this._attachOrRemoveEvents("remove")},this.show=function(e,t){var n=document.createElement("div");n.innerHTML=e;var r=this._findElementByClass(n,"ol-modal");if(r)this._bindCloseButton(this._findElementByClass(r,"ol-close")),this._bindConfirmButton(this._findElementByClass(r,"ol-confirm"));else{r=this._newElement("div","ol-modal "+this._extraClasses.join(" "));var i=this._newElement("div","ol-content",r);if((t||this._showCloseButton)&&this._showHeader){var o=this._newElement("div","ol-header",i);if(t)this._newElement("div","ol-title",o).innerHTML=t;if(this._showCloseButton&&this._bindCloseButton(this._newElement("div","ol-close",o)),this._showConfirmButton){var s=this._newElement("div","ol-footer",i);this._bindConfirmButton(this._newElement("div","ol-confirm",s))}}else if(!this._showHeader&&this._showCloseButton){var a=this._newElement("div","ol-close",i);this._bindCloseButton(a)}this._newElement("div","ol-body",i).innerHTML=e}return r.id=this._id,document.body.firstChild.parentNode.insertBefore(r,document.body.firstChild),this._attachEvents(),this._emitEvent("ol-modal-create"),r},this.close=function(){var e=this,t=document.getElementById(this._id);this._emitEvent("ol-modal-hide"),this._hideModal(t),setTimeout(function(){e._emitEvent("ol-modal-remove"),e._removeEvents(),t.parentNode&&t.parentNode.removeChild(t),t=null},500)}}r.prototype._findElementByClass=function(e,t){return e.getElementsByClassName?e.getElementsByClassName(t)[0]:e.querySelector("."+t)},r.prototype._hideModal=function(e){e.className+=" ol-hide"},r.prototype._emitEvent=function(e,t){var n;"function"==typeof CustomEvent?n=new CustomEvent(e,t):(n=document.createEvent("CustomEvent")).initEvent(e,!0,!0),n&&document.dispatchEvent(n)},r.prototype._addEventListener=function(e,t,n,r){n&&(e.addEventListener?e.addEventListener(t,n,!r):e.attachEvent&&e.attachEvent("on"+t,n))},r.prototype._removeEventListener=function(e,t,n){n&&(e.removeEventListener?e.removeEventListener(t,n,!0):e.attachEvent&&e.detachEvent("on"+t,n))},r.prototype._newElement=function(e,t,n){var r=document.createElement(e);return r.className=t,n&&n.appendChild(r),r},t.exports=r},{"../../utils":40}],16:[function(e,t,n){var u=e("./eventDispatcher"),c=e("ouibounce");function l(e,t){return e.getAttribute(t)||(0===t.indexOf("data-")?e.getAttribute(t.substring(5)):e.getAttribute("data-"+t))}function d(e,t){return setTimeout(function(){t()},100),"immediate-trigger"}t.exports={setModalTriggerStrategy:function(e,t,n){var r=e.trace||function(){},i=document.createElement("html"),o=document.createElement("body");o.innerHTML=t,i.appendChild(o);var s,a=i.childNodes[0].firstChild;switch(l(a,"ol-trigger")){case"exit-intent":return r("modal.trigger.strategy","info","Trigger strategy for modal content is exit-intent"),u.dispatchInternalEvent("Preload-Exit-Intent-Trigger-Applied"),s=n,c(!1,{cookieExpire:0,callback:function(){s()}}),"exit-intent-trigger";case"timed":return r("modal.trigger.strategy","info","Trigger strategy for modal content is timed"),u.dispatchInternalEvent("Preload-Timed-Trigger-Applied"),function(e,t){var n=l(e,"ol-trigger-delay");if(!n)return d(0,t);var r=parseInt(n,10);return r?(setTimeout(function(){t()},1e3*r),"timer-trigger"):d(0,t)}(a,n);default:return r("modal.trigger.strategy","info","Trigger strategy for modal content is immediate"),u.dispatchInternalEvent("Preload-Immediate-Trigger-Applied"),"immediate-trigger"}}}},{"./eventDispatcher":12,ouibounce:2}],17:[function(e,t,n){var r=e("./safari-support.js");t.exports=r.supportsPushNotification()?e("./safari.js"):e("./w3c.js")},{"./safari-support.js":18,"./safari.js":19,"./w3c.js":20}],18:[function(e,t,n){var r={supportsPushNotification:function(){return"safari"in window&&"pushNotification"in window.safari}};t.exports={supportsPushNotification:r.supportsPushNotification}},{}],19:[function(e,t,n){var u=e("../../../utils/").Promise,r=e("./safari-support.js");t.exports={isSupported:function(){var e=r.supportsPushNotification();return u.resolve(e)},isHttpWebPushSupported:function(){return u.resolve(!0)},requiresDeliverabilityDelete:function(){return u.resolve(!1)},getSubscriptionDetails:function(e){var t=window.safari.pushNotification.permission(e.safariWebsitePushId);return t&&t.deviceToken?u.resolve({deviceToken:t.deviceToken}):u.resolve()},saveSubscriptionDetails:function(){return u.resolve()},removeSubscriptionDetails:function(){return u.resolve()},register:function(e){var t=e.trace||function(){},i=e.server.jsSdkService+"/safari",o=e.safariWebsitePushId,s=e.data.app_key,a=e.data.tracking_id;if(o){return function r(e){return"default"===e.permission?(t("push.subscribe.safari","info","Requesting push notification permission on Safari.",{webserviceUrl:i,websitePushID:o,payload:{appKey:s,trackingId:a}}),new u(function(t,n){try{window.safari.pushNotification.requestPermission(i,o,{appKey:s,trackingId:a},function(e){r(e).then(t,n)})}catch(e){n(e)}})):"granted"===e.permission?(t("push.subscribe.safari","info","Push notification permission granted on Safari.",{websitePushID:o}),u.resolve({platform:"safari",websitePushId:o,deviceToken:e.deviceToken})):"denied"===e.permission?(t("push.subscribe.safari","info","Push notification permission denied on Safari.",{websitePushID:o}),u.reject(new Error("Push notification permission denied for this website."))):u.reject(new Error('Unknown push notification permission: "'+e.permission+'".'))}(window.safari.pushNotification.permission(o))}return u.reject(new Error('Cannot request push notification permission without a valid "safariWebsitePushId".'))},unregister:function(){return u.resolve()},isRegistered:function(e){if(e.safariWebsitePushId){var t=window.safari.pushNotification.permission(e.safariWebsitePushId);return u.resolve("granted"===t.permission)}return u.reject(new Error('Cannot check push notification permission without a valid "safariWebsitePushId".'))},getNotificationPermission:function(e){var t=e.safariWebsitePushId;if(t){var n=window.safari.pushNotification.permission(t);return u.resolve(n.permission)}return u.reject(new Error('Cannot check push notification permission without a valid "safariWebsitePushId".'))},getCurrentDeliveryDetails:function(){return u.resolve()},getLastPushMessage:function(){return u.resolve()},peekLastPushMessage:function(){return u.resolve()},setTracingId:function(){return u.resolve()},setTracingEnabled:function(){return u.resolve()},setTracingDisabled:function(){return u.resolve()},readTraceEvents:function(){return u.resolve([])},clearTraceEvents:function(){return u.resolve([])},saveRecipientDetails:function(){return u.resolve()},supportsVAPIDWebPush:function(){return!1},getServiceWorkerConfig:function(){return u.resolve({status:"not supported on Safari"})}}},{"../../../utils/":40,"./safari-support.js":18}],20:[function(e,t,n){var r,i,u=e("../../../utils/browserpush.js"),c=e("../../../utils/index.js"),s=c.Promise,o="ol-service-worker",a="last_message",l="app_key",d="tracking_id",p=u.traceDbName,f="OL_last_permission",g="OL_SubscriptionEndpoint";function h(){return r=r||new u.IndexedDBWrapper(o,1)}function m(){return!i&&u.isIndexedDBSupported()&&(i=new u.IndexedDBWrapper(p,1,{autoIncrement:!0})),i}function v(){return window.location!==window.parent.location}function b(e,t){var n=h();return n.put(l,e).then(function(){return n.put(d,t)})}function y(e,t){return h().put(e,t)}t.exports={isSupported:function(){var e=window.PushManager||navigator.push,t=window.Notification,n=navigator.serviceWorker,r=!!(e&&t&&n),i=!!document.documentMode,o=!i&&!!window.StyleMedia;return s.resolve(r&&!(i||o))},isHttpWebPushSupported:function(){return s.resolve(!1)},requiresDeliverabilityDelete:function(){return s.resolve(!0)},getSubscriptionDetails:function(e,t){var n=t.get(g);return n?s.resolve({subscriptionUrl:n}):s.resolve()},saveSubscriptionDetails:function(e,n,r){return new s(function(e,t){try{n.set(g,r.subscriptionUrl,c.getLongTermExpiry()),e()}catch(e){t(e)}})},removeSubscriptionDetails:function(e,n){return new s(function(e,t){try{n.set(g,null),e()}catch(e){t(e)}})},register:function(o,s){var a=o.trace||function(){};return c.executeWithPromise(window.Notification.requestPermission).then(function(e){if(s.set(f,e,c.getLongTermExpiry()),a("push.subscribe.permission","info",'Notification permissions are "'+e+'".',{permission:e}),"granted"===e)return t=o.serviceWorkerLocation,n=o.serviceWorkerScope,r=o.vapidPublicKey,a("push.subscribe.worker","info","Registering worker",{workerPath:t,workerOptions:i={scope:n,updateViaCache:"none"}}),navigator.serviceWorker.register(t,i).then(function(){return navigator.serviceWorker.ready}).then(function(e){return e.update()}).then(function(e){var t={userVisibleOnly:!0};return void 0!==r&&(t={userVisibleOnly:!0,applicationServerKey:c.urlBase64ToUint8Array(r)}),e.pushManager.subscribe(t).then(null,function(e){throw"denied"===window.Notification.permission?new Error("User permanently disabled permissions for this website."):e})}).then(function(e){a("push.subscribe.worker","info","Registered worker and got subscription");var t=u.getDeliveryDetails(e);return t.isVapid=void 0!==o.vapidPublicKey,t}).then(void 0,function(e){throw a("push.subscribe.worker","error","Error while registering worker",{error:e.message,stack:e.stack}),e});throw"denied"===e?(a("push.subscribe.permission","info","Notification permissions are denied.",{permission:e}),new Error("User permanently disabled permissions for this website")):new Error("User ignored permission request for this website. Subscription attempt can be repeated");var t,n,r,i}).then(function(e){return b(o.data.app_key,o.data.tracking_id).then(function(){return e})})},unregister:function(e,t,n){var r=e.trace||function(){};return(!v()||"chrome"!==t&&"firefox"!==t?navigator.serviceWorker.ready.then(function(e){if(e.active)return e.pushManager.getSubscription().then(function(e){if(e){var t=u.getDeliveryDetails(e);return e.unsubscribe().then(function(){return r("push.unsubscribe.pushSubscription","info","platform push - subscription found and unsubscribed.",t),t})}r("push.unsubscribe.pushSubscription","info","Could not find pushSubscription.")});r("push.unsubscribe.service-worker","info","Could not find service worker registration.")}):new s(function(e){r("push.unsubscribe.chrome","info","Returning stored subscription URL for Chrome.");var t=n.get(g);"undefined"!==t&&null!==t?e({subscriptionUrl:t}):e()})).then(function(e){return n.set(f,null),(t=h()).delete(l).then(function(){return t.delete(d)}).then(function(){return e});var t})},isRegistered:function(e,n){var r=e.trace||function(){};return navigator.serviceWorker&&navigator.serviceWorker.ready?v()?h().get("sw_keepalive_timestamp").then(function(e){return!e||parseInt(e,10)+6048e5<(new Date).getTime()}).catch(function(){return!0}).then(function(e){var t="granted"===n.get(f)&&!e;return r("push.isRegistered.iFrame.permission","info",'Notification permissions are "'+window.Notification.permission+'".',{permission:window.Notification.permission}),r("push.isRegistered.iFrame","info",'isReadyToResubscribe: "'+e+'".',{isReady:e}),t},function(e){return r("push.isRegistered.iFrame.error","info","Error with push.isRegistered in iFrame. Handling this as if the user is not subscribed.",{error:e}),!1}):navigator.serviceWorker.getRegistration(e.serviceWorkerScope).catch(function(){return!!navigator.serviceWorker.ready}).then(function(t){return!(!t||!t.active)&&t.pushManager.permissionState({userVisibleOnly:!0}).then(function(e){return"granted"===e&&t.pushManager.getSubscription().catch(function(){return!1}).then(function(e){return!!e})})}):(r("push.isRegistered.noserviceworker","info","isRegistered found no service worker support."),s.resolve(!1))},getNotificationPermission:function(e,t){var n=e.trace||function(){};if(Notification&&Notification.permission){var r=Notification.permission;if(v()){var i=t.get(f);n("push.getNotificationPermission.iFrame","info",'permission: "'+(r="undefined"!==i&&null!==i?i:"default")+'".',{iFrame:v(),browserPermission:Notification.permission,storedPermission:i})}return s.resolve(r)}return s.reject(new Error("Notification permissions not supported"))},getCurrentDeliveryDetails:function(e){var t=e.trace||function(){};return t("push.getCurrentDeliveryDetails","info","Executing details lookup."),navigator.serviceWorker.ready.then(function(e){return e.active?e.pushManager.getSubscription().then(function(e){return e?(t("push.getCurrentDeliveryDetails.pushSubscription","info","Found pushSubscription, returning delivery details."),s.resolve(u.getDeliveryDetails(e))):(t("push.getCurrentDeliveryDetails.pushSubscription","info","Could not find pushSubscription."),s.resolve({}))}):(t("push.getCurrentDeliveryDetails.service-worker","info","Could not find service worker registration with attempting to retrieve delivery details."),s.resolve())})},getLastPushMessage:function(){return h().get(a).then(function(e){return h().delete(a),e}).catch(function(){h().delete(a)})},peekLastPushMessage:function(){return h().get(u.lastMessageReceivedKey).then(function(e){return e})},setTracingId:function(e){return y(u.tracingIdStorageKey,e)},setTracingEnabled:function(){return y(u.tracingEnabledKey,!0)},setTracingDisabled:function(){return e=u.tracingEnabledKey,h().delete(e);var e},readTraceEvents:function(){var e=m();return e?e.getAll().then(function(e){return e.map(function(e){return JSON.parse(e)})}):s.resolve([])},clearTraceEvents:function(){var e=m();return e?e.clear().then(function(){}):s.resolve()},getServiceWorkerConfig:function(){if(navigator.serviceWorker&&navigator.serviceWorker.controller){var e=navigator.serviceWorker.ready.then(function(n){if(n){var t=h(),e=["oldSubscription","newSubscription","endpoint","payload"],r=e.map(function(e){return t.get("ol-sw.subscription-change."+e).catch(function(e){return"could not get: "+e.message})});return s.all(r).then(function(r){return e.reduce(function(e,t,n){return e[t]=r[n],e},{})}).then(function(e){var t={scope:n.scope,subscriptionChangeTrace:e};return n.active?n.pushManager.getSubscription().then(function(e){return t.subscriptionEndpoint=e?e.endpoint:"undefined",t.status=n.active.state,t.scriptURL=n.active.scriptURL,t}):(n.installing?(t.status=n.installing.state,t.scriptURL=n.installing.scriptURL):n.waiting&&(t.status=n.waiting.state,t.scriptURL=n.waiting.scriptURL),t)})}return{status:"no service worker registration present"}});return new s(function(t,n){var r=!1;e.then(function(e){r=!0,t(e)},function(e){r=!0,n(e)}),setTimeout(function(){r||t({status:"not ready"})},7e3)})}return s.resolve({status:"not installed"})},saveRecipientDetails:function(e,t){return b(e,t)},supportsVAPIDWebPush:function(){return!0}}},{"../../../utils/browserpush.js":38,"../../../utils/index.js":40}],21:[function(e,t,n){var u=e("../../utils/index.js"),s="ol-",i=null,c="ol-exp-",l={set:function(e,t,n){""===t||null==t?(window.localStorage.removeItem(c+e),window.localStorage.removeItem(e)):(window.localStorage.setItem(e,t),n?window.localStorage.setItem(c+e,n.getTime()):window.localStorage.removeItem(c+e))},get:function(e){var t=window.localStorage.getItem(e),n=window.localStorage.getItem(c+e);return null===t?null:n&&new Date(parseInt(n)).getTime()<(new Date).getTime()?(window.localStorage.removeItem(e),window.localStorage.removeItem(c+e),null):t},clear:function(){window.localStorage.clear()},isSupported:function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}(),name:"localstorage"},d={setDomain:function(e){i=e},set:function(e,t,n){var r=s+e+"="+(""===t||null==t?"":t)+";path=/";n&&(r+=";expires="+n.toGMTString()),i&&"localhost"!==i&&(r+=";domain="+i),document.cookie=r},get:function(e){for(var t=s+e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(i.substring(0,t.length)===t){var o=i.substring(t.length,i.length);return""===o?null:o}}return null},clear:function(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var n=e[t].trim();if(n.substring(0,s.length)===s){var r=u.arrayIndexOf(n,"="),i=-1<r?n.substr(s.length,r-s.length):n;d.set(i,"",new Date(-1))}}e=document.cookie.split(";")},migrateLocalStorageData:function(e,t){var n=window.location.hostname;if(l.isSupported){var r,i,o=[];for(r=0;r<window.localStorage.length;r++)if(null!==(i=window.localStorage.key(r))&&i.substring(0,7)!==c&&"OL_"===i.substring(0,3)){var s=window.localStorage.getItem(i);if(o.push(i),null!==s&&(null===d.get(i)||n===t)){var a=window.localStorage.getItem(c+i);a=null!==a?new Date(parseInt(a)):u.getLongTermExpiry(),d.set(i,s,a)}}for(r=0;r<o.length;r++)l.set(o[r],null)}},isSupported:!0,name:"cookiestorage"};(d.alternativeStorage=l).alternativeStorage=d,t.exports={getStorage:function(e){if(void 0!==e&&e.multipleSubdomains||!l.isSupported){var t=d;e.multipleSubdomains&&t.setDomain(e.baseDomain);var n=void 0===e.dataMigrationSubdomain?e.primarySubdomain:e.dataMigrationSubdomain;return t.migrateLocalStorageData(e.baseDomain,n),t}return l},reset:function(){d.clear(),l.isSupported&&l.clear()},localStorage:l,cookieStorage:d}},{"../../utils/index.js":40}],22:[function(t,e,n){function r(){this._init()}r.prototype._init=function(){this.executingRequest=null,this.queue=[],this.retryAttemptCount=0,this.retryDelaysInSeconds=[1,1,2,3,5,8,13]},r.prototype._sendRequest=function(e){t("../../platform/").http[e.method.toLowerCase()](e.url,e.data,e.asJson,this._onDone(e))},r.prototype._dispatchRequest=function(e){if(e){if(this.executingRequest&&e!==this.executingRequest)return void this.queue.push(e)}else e=this.queue.shift();if(this.executingRequest=e||null,e){var t=this.retryAttemptCount?this.retryDelaysInSeconds[this.retryAttemptCount-1]:0;if(t){var n=this;setTimeout(function(){n._sendRequest(e)},1e3*t)}else this._sendRequest(e)}},r.prototype._createRequest=function(e,t,n){var r=n;return r.method=e,r.url=t,r},r.prototype.dispatchDeleteRequest=function(e,t){var n=this._createRequest("delete",e,t);this._dispatchRequest(n)},r.prototype.dispatchGetRequest=function(e,t){var n=this._createRequest("get",e,t);this._dispatchRequest(n)},r.prototype.dispatchPostRequest=function(e,t){var n=this._createRequest("post",e,t);this._dispatchRequest(n)},r.prototype.dispatchPutRequest=function(e,t){var n=this._createRequest("put",e,t);this._dispatchRequest(n)},r.prototype._onDone=function(r){var i=this;return function(e,t){if(e){r.onError&&r.onError(e);var n=e.statusCode;0===n||500<=n?(i.retryAttemptCount<i.retryDelaysInSeconds.length&&i.retryAttemptCount++,i._dispatchRequest(r)):i._dispatchRequest()}else r.onSuccess&&r.onSuccess(t),0<i.retryAttemptCount&&i.retryAttemptCount--,i._dispatchRequest()}},e.exports=new r},{"../../platform/":24}],23:[function(e,t,n){var u=e("underscore"),c={_urlEncodeObject:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},_sendRequest:function(e,t,n,r,i,o){var s;try{s=new window.XMLHttpRequest}catch(e){return void(o&&o(e))}s.open(e,t,!window.__adapter__);var a=r?"application/json":"application/x-www-form-urlencoded";s.setRequestHeader("Content-Type",a+"; charset=UTF-8"),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),n&&u.isObject(n)&&(n=r?JSON.stringify(n):c._urlEncodeObject(n));s.onreadystatechange=function(){4===s.readyState&&function(){if(200<=s.status&&s.status<300)i&&i(s);else if(o){var e=new Error(0!==s.status||s.responseText?s.responseText||"API response status: "+s.status:"Could not connect to the API");e.statusCode=s.status,e.url=t,o(e)}}()},s.send(n||null)},post:function(e,t,n,r,i){c._sendRequest("POST",e,t,n,r,i)},put:function(e,t,n,r,i){c._sendRequest("PUT",e,t,n,r,i)},get:function(e,t,n,r,i){c._sendRequest("GET",e,null,!0,r,i)},delete:function(e,t,n,r,i){c._sendRequest("DELETE",e,t,n,r,i)}};t.exports={post:c.post,put:c.put,get:c.get,delete:c.delete}},{underscore:3}],24:[function(e,t,n){t.exports=e("./browser")},{"./browser":14,"./mock":void 0,"./titanium":void 0}],25:[function(e,t,n){var d=e("../platform"),p=e("./push"),r=e("./logging"),i=e("./tracing"),o=e("../utils");var s={enableTracing:function(e,t){e.tracingEnabled=!0,i.enableTracing(e),i.trace(e,"tracer.enabled","info","Tracer enabled on page",location),o.isHTTPS()||o.isLocalhost()||r.info("WARNING: Dynamically enabling tracing in an HTTP cross-origin configuration may inadvertently modify the tracing settings of the remote service worker."),d.setStoredValue("OL_TraceEnabled",e.tracingEnabled,o.getLongTermExpiry()),t&&t(e.tracingEnabled)},disableTracing:function(e,t){e.tracingEnabled=!1,o.isHTTPS()||o.isLocalhost()||r.info("WARNING: Dynamically disabling tracing in an HTTP cross-origin configuration may inadvertently modify the tracing settings of the remote service worker.");function n(){d.setStoredValue("OL_TraceEnabled",e.tracingEnabled,o.getLongTermExpiry()),t&&t(e.tracingEnabled)}i.disableTracing(e).then(n,n)},debug:function(a,u){var c=e("./tracking"),l={};p.isPushSupported(a,function(s){p.isSubscribedToPush(a,function(o){p.getNotificationPermission(a,function(i){p.getServiceWorkerConfig(a).then(function(r){p.peekLastPushMessage(a).then(function(e){var t=d.getStoredValue("OL_WEB_DEVICE_ID"),n=d.getStoredValue("OL_VAPID_migration_on");return l={app:{app_key:a.data.app_key,app_name:a.data.app_name,last_install_time:a.data.lit,last_clean_install_time:a.data.acit,version:a.data.lv},user_data:{current_phash:a.data.phash,tracking_id:c.getTrackingId(a),prev_tracking_id:a.data.prev_tracking_id,session_id:a.data.sid,session_length_ms:a.data.session_length,average_session_length_ms:a.data.average_session_length,web_device_id:t},web_push:{is_supported:s,is_subscribed:o,notification_permission:i,last_push_message:e,vapid_public_key:a.vapidPublicKey,vapid_migration_on:n},service_worker:r,configuration:{session_expiration_seconds:a.sessionExpirationSeconds,notification_yes_url:a.permissionUrls.notificationYes,cross_origin_receiver_url:a.crossOriginReceiverUrl,cross_origin_receiver_mode:a.crossOriginReceiverMode,multiple_subdomains:a.multipleSubdomains,primary_subdomain:a.primarySubdomain,data_migration_subdomain:a.dataMigrationSubdomain,preload_content:a.preloadContent,safari_website_push_id:a.safariWebsitePushId},endpoints:a.server,platformSettings:function(){var e=d.platformSettings().data,t={};if(t.browser=d.getBrowserName(),d.getUserAgentHeader&&(t.user_agent=d.getUserAgentHeader()),d.getOLScriptUrls&&(t.ol_scripts=d.getOLScriptUrls()),"undefined"!==e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}()},u&&u(l),l})})})})})}};t.exports={debug:s.debug,enableTracing:s.enableTracing,disableTracing:s.disableTracing}},{"../platform":24,"../utils":40,"./logging":27,"./push":31,"./tracing":35,"./tracking":36}],26:[function(l,e,t){var n={registerEvent:function(e,t,n,r,i){var o=l("./logging.js"),s=l("./tracking.js"),a=l("../platform/browser/xhr-queue.js");o.info("registerEvent",t,n);var u={acit:e.data.acit,app_key:e.data.app_key,event_label:n,event_type:t,language:e.data.language,lit:e.data.lit,lv:e.data.lv,phash:e.data.phash,prev_tracking_id:e.data.prev_tracking_id,sid:e.data.sid,tracking_id:s.getTrackingId(e)};i&&(u.phash=i);var c=e.server.apiEndpoint+"/register_app_event";a.dispatchPostRequest(c,{data:u,onSuccess:r,onError:e.onError})}};e.exports={registerEvent:n.registerEvent}},{"../platform/browser/xhr-queue.js":22,"./logging.js":27,"./tracking.js":36}],27:[function(o,e,t){var s=o("../platform/").logger(),n={debug:1,info:2,warn:3,error:4,off:5},r={LOG_LEVELS:n,logLevel:n.warn,debug:function(){r.logLevel<=n.debug&&r.performLog("DEBUG",s.debug,Array.prototype.slice.call(arguments))},info:function(){r.logLevel<=n.info&&r.performLog("INFO",s.info,Array.prototype.slice.call(arguments))},warn:function(){r.logLevel<=n.warn&&r.performLog("WARN",s.warn,Array.prototype.slice.call(arguments))},error:function(){r.logLevel<=n.error&&r.performLog("ERROR",s.error,Array.prototype.slice.call(arguments))},trace:function(){r.performLog("INFO",s.info,Array.prototype.slice.call(arguments))},performLog:function(e,t,n){if(s&&s.log){var r="",i=o("../utils/");i.isTopWindow()||(r="("+i.getPageUrl()+")"),n.unshift("OL "+r+"["+e+"]:"),(t||s.log).apply(s,n)}}};e.exports=r},{"../platform/":24,"../utils/":40}],28:[function(v,e,t){var b=v("./logging.js"),y=v("../platform/"),_=v("./event.js"),w=v("./session.js"),u=v("./tracking.js"),c=v("../platform/browser/xhr-queue.js"),S={markInterstitialAsDisplayed:function(t,e){var n={phash:e.phash,templateId:e.templateid,splitId:e.splitid},r=t.server.contentEndpoint+"/"+t.data.app_key+"/"+u.getTrackingId(t)+"/interstitial/v2/mark-displayed";y.dispatchInternalEvent("Mark-Displayed"),c.dispatchPostRequest(r,{data:n,asJson:!0,onSuccess:function(){b.debug("Successfully marked interstitial as displayed.")},onError:function(e){b.error("Error marking interstitial as displayed.",e),t.onError&&t.onError(e)}})},receivedPushNotification:function(e,t){w.setPhash(e,t.p)},splitTestNotification:function(s,e,t,a){if(e&&t&&a){var n={pushtext:e,campaigntoken:t,responsetype:"json",realtime_filtering:!0},r=u.getTrackingId(s);r&&(n.trackingid=r),s.data.phash&&(n.phash=s.data.phash);var i=s.server.mdnEndpoint+"/message/analytics";c.dispatchPostRequest(i,{data:n,asJson:!0,onSuccess:function(e){if(e&&0!==e.errorcode){var t=e.errorinfo?e.errorinfo:"Unexpected error received";b.error("Error while getting split test notification",t),s.onError&&s.onError(t)}else if(e){var n=decodeURIComponent(e.messagetext),r=e.messagecontent,i=e.phash,o={settings:s,phash:i};b.info("Received text for split test notification:",n),a(n,r,function(){w.setPhash(o.settings,o.phash),o=null,b.info("User accepted notification")})}else b.info("No result received")},onError:function(e){b.error("Error while getting split test notification"),s.onError&&s.onError(e)}})}else b.error("method signature is incorrect")},displayInterstitial:function(p,s,f,g,h,m,e){function t(e,t){if(b.debug("Received interstitial",e),e&&e.message){function a(){w.setPhash(i.settings,i.phash),b.info("Pushed new phash.",i.phash),i=null}var u=e.message.phash,c=JSON.parse(decodeURIComponent(e.message.messagecontent)),n=c.subject.replace(/\s+/g,"-").toLowerCase(),r=decodeURIComponent(c.html),i={settings:p,phash:u},l=v("../utils/"),d={};l.forEachInObject(f,function(o,s){d[o]=function(e,t){var n=o.split(/\s+/),r=l.capitalize(n[0]),i=n[1];_.registerEvent(p,r,{id:i},null,u),(t=t||{}).pushPhash=a,t.meta=c,s(e,t)}});var o=y.showEmptyModal(["ol-interstitial",n],r,d,function(){_.registerEvent(p,"Close",{},null,u),g&&g({meta:c})});if(h)h({phash:u,modal:o});y.dispatchInternalEvent("Interstitial-Displayed"),v("./tracing.js").trace(p,"notification.interstitial.display","info","Ready to mark as displayed if cached.",{cached:t}),t&&(y.clearStoredValue("OL-Content-"+s),S.markInterstitialAsDisplayed(p,e.message))}else m&&m()}var n=y.getStoredValue("OL-Content-"+s);if(n)t(JSON.parse(n),!0);else{var r={placement:s};if(e&&void 0!==e.displayGroup){var i=isNaN(parseInt(e.displayGroup,10))?void 0:parseInt(e.displayGroup,10);r.displayGroup=i}var o=p.server.contentEndpoint+"/"+p.data.app_key+"/"+u.getTrackingId(p)+"/interstitial/v2/fetch?preload=false";c.dispatchPostRequest(o,{data:r,asJson:!0,onSuccess:t,onError:function(e){b.error("Error getting interstitial",e),p.onError&&p.onError(e)}})}},showSimpleModal:function(e,t,n,r,i){y.showSimpleModal(e,t,n,r,i)}};e.exports={receivedPushNotification:S.receivedPushNotification,splitTestNotification:S.splitTestNotification,showSimpleModal:S.showSimpleModal,displayInterstitial:S.displayInterstitial}},{"../platform/":24,"../platform/browser/xhr-queue.js":22,"../utils/":40,"./event.js":26,"./logging.js":27,"./session.js":33,"./tracing.js":35,"./tracking.js":36}],29:[function(s,e,t){var a=s("./push"),u=s("./notification"),c=s("./logging"),l=s("./event"),d=s("../utils"),p=s("./tracing"),f={"notification-prompt-no":function(e,t){c.debug("user declined soft opt-in"),t&&t("notification-prompt-no")},"notification-prompt-yes":function(t,n){var e=s("./tracking");if(t.permissionUrls.notificationYes){var r=d.updateUrlParameter(t.permissionUrls.notificationYes,"_oltid",e.getTrackingId(t));t.data.sid&&(r=d.updateUrlParameter(r,"_olsid",t.data.sid)),void 0!==t.tracingEnabled&&(r=d.updateUrlParameter(r,"tracingEnabled",t.tracingEnabled)),p.trace(t,"permission.soft-opt-in.pop-up","info","Displaying pop-up to finalise web push subscription.",{url:r,popupOptions:t.popupOptions});var i=window.open(r,"",t.popupOptions),o=function(){null!==i&&i.closed?(p.trace(t,"permission.soft-opt-in.pop-up","info","Pop-up has been closed."),a.isSubscribedToPush(t,function(e){e?p.trace(t,"permission.soft-opt-in.subscribed","info","Subscribed to web push."):p.trace(t,"permission.soft-opt-in.subscribed","info","Browser push subscription unsuccessful."),n(e?"subscribed":"notsubscribed")})):setTimeout(o,2e3)};setTimeout(o,2e3)}else p.trace(t,"permission.soft-opt-in.subscribe","info","Finalising subscription on current domain."),a.subscribeToPush(t,function(e){var t=void 0!==e&&"Delivery Details updated"===e.response?"subscribed":"notsubscribed";n(t)})},"notification-settings-yes":function(e,t){-1!==navigator.userAgent.indexOf("Chrome")?(p.trace(e,"permission.soft-opt-in.settings","info","Displaying settings info in another tab.",{url:e.permissionSettingsUrls.chrome}),window.open(e.permissionSettingsUrls.chrome).onbeforeunload=function(){t()}):setTimeout(function(){p.trace(e,"permission.soft-opt-in.settings","info","Displaying settings info in another tab.",{url:e.permissionSettingsUrls.firefox}),window.open(e.permissionSettingsUrls.firefox).onbeforeunload=function(){t()}},100)}},g="Notification Settings",h={_processPermissionAction:function(n,r,e,i,o){return function(){var e=i.replace("/","");c.info("Permission action "+e+" clicked"),p.trace(n,"permission.soft-opt-in.click","info","Button clicked in interstitial",{action:e}),l.registerEvent(n,e,{},null,r.phash);var t=f[e];return t?(c.debug("Function found for action"),t(n,o)):o&&o(),r.modal.close(),!1}},_onLoaded:function(e,t,n){l.registerEvent(e,"notification-prompt-displayed",{},null,t.phash);for(var r=/otherlevels:\/\/(.*)/i,i=document.links,o=i.length,s=0;s<o;s++){var a=r.exec(i[s].href);a&&(c.debug("Found otherlevels scheme link in document with action"+a[1]),i[s].onclick=h._processPermissionAction(e,t,i[s],a[1],n))}},_askForNotificationPermission:function(r,i,o){c.debug("About to check for notification permission"),a.isPushSupported(r,function(e){if(!e)return p.trace(r,"permission.ask","info","Web push is not supported. Doing nothing."),c.info("Push is not supported, take no action"),o("push not supported");a.getNotificationPermission(r,function(t){function n(e){h._onLoaded(r,e,o)}a.isSubscribedToPush(r,function(e){"default"===t||"granted"===t&&!e||"granted"===t&&!d.isHTTPS()?(c.info("Prompting for Interstitial with placement ",i),p.trace(r,"permission.soft-opt-in","info","Permission: "+t+"; isSubscribed: "+e+". Displaying soft opt-in interstitial."),u.displayInterstitial(r,i,{},function(){},n,function(){p.trace(r,"permission.soft-opt-in.notfound","error","No matching notification permission interstitial found for placement",{placement:i});var e='No matching notification permission interstitials ("'+i+'" placement) found for this tracking id - check filters on interstitials';c.debug(e),o(e)})):"denied"===t?(c.info("Prompting for Interstitial with placement Notification Settings"),p.trace(r,"permission.soft-opt-in","info","Browser notification permissions have been denied. Displaying setting configuration interstitial"),u.displayInterstitial(r,g,{},function(){},n,function(){p.trace(r,"permission.soft-opt-in.notfound","error","No matching notification settings interstitial found for placement",{placement:i});var e='No matching notification settings interstitials ("'+g+'" placement)  found for this tracking id - check filters on interstitials.';c.debug(e),o(e)})):(p.trace(r,"permission.soft-opt-in","info","Permissions have already been granted before."),f["notification-prompt-yes"](r,o))})})})},askForPermission:function(e,t,n,r){var i=d.isFunction(r)?r:d.isFunction(n)?n:void 0,o=n&&!d.isFunction(n)&&n.placement?n.placement:"Notification Prompt";if("notification"===t)return p.trace(e,"permission.ask","info",'Asking for "notification" permissions for web push with soft opt-in',{placement:o}),h._askForNotificationPermission(e,o,i);c.error("invalid permission"),r("invalid permission")}};e.exports={askForPermission:h.askForPermission}},{"../utils":40,"./event":26,"./logging":27,"./notification":28,"./push":31,"./tracing":35,"./tracking":36}],30:[function(f,e,t){var r=f("underscore"),g=f("./logging.js"),h=f("../platform/"),m=f("./event.js"),v=f("./tracing.js"),u=f("./tracking.js"),c=f("../platform/browser/xhr-queue.js"),b="Notification Prompt",i=["App Open","Feedback","Location Prompt","Location Settings","Manual Location Settings","Manual Notification Settings",b,"Notification Settings","Placement 1","Placement 2","Placement 3","Placement 4","Placement 5","Placement 6","Placement 7","Placement 8","Placement 9","Placement A","Placement B","Placement C","Placement D","Placement E","Placement F","Push Open","Store Launch"],y={_setupInterstitialEventHandlers:function(a,u,c,e){function l(){f("./session.js").setPhash(n.settings,n.phash),g.info("Pushed new phash.",n.phash),n=null}var t={},n={settings:a,phash:c},d=f("../utils/");return d.forEachInObject(e,function(o,s){t[o]=function(e,t){var n=o.split(/\s+/),r=d.capitalize(n[0]),i=n[1];m.registerEvent(a,r,{id:i},null,c),(t=t||{}).pushPhash=l,t.meta=u,s(e,t)}}),t},_makePreloadHttpRequest:function(e,t,n,r,i){var o={placement:t};if(n&&n.displayGroup){var s=isNaN(parseInt(n.displayGroup,10))?void 0:parseInt(n.displayGroup,10);o.displayGroup=s}var a=e.server.contentEndpoint+"/"+e.data.app_key+"/"+u.getTrackingId(e)+"/interstitial/v2/fetch?preload=true";c.dispatchPostRequest(a,{data:o,asJson:!0,onSuccess:r,onError:i})},markInterstitialAsDisplayed:function(t,e){var n={phash:e.phash,templateId:e.templateid,splitId:e.splitid},r=t.server.contentEndpoint+"/"+t.data.app_key+"/"+u.getTrackingId(t)+"/interstitial/v2/mark-displayed";h.dispatchInternalEvent("Mark-Displayed"),c.dispatchPostRequest(r,{data:n,asJson:!0,onSuccess:function(){g.debug("Successfully marked interstitial as displayed.")},onError:function(e){g.error("Error marking interstitial as displayed.",e),t.onError&&t.onError(e)}})},_showCachedInterstitial:function(e,t,n,r,i){var o=h.getStoredValue("OL-Content-"+t);if(o){var s=JSON.parse(o),a=s.message.phash,u=JSON.parse(decodeURIComponent(s.message.messagecontent)),c=u.subject.replace(/\s+/g,"-").toLowerCase(),l=decodeURIComponent(u.html),d=y._setupInterstitialEventHandlers(e,u,a,i),p=h.showEmptyModal(["ol-interstitial",c],l,d,function(){m.registerEvent(e,"Close",{},null,a),n&&n({meta:u})});if(r)r({phash:a,modal:p});h.clearStoredValue("OL-Content-"+t),y.markInterstitialAsDisplayed(e,s.message)}},_preloadInterstitial:function(s,a,u,c,l,d,n){v.trace(s,"preload.preloadInterstitial","info","Beginning interstitial preload for placement.",{placement:a});var p=a===b;function r(e){if(g.debug("Received preload interstitial.",e),v.trace(s,"preload.preloadInterstitial","info","Received preload interstitial.",{message:e.message}),e&&e.message){var t={message:e.message};h.setStoredValue("OL-Content-"+a,JSON.stringify(t));var n=f("../utils/facade.js"),r=p?n.getAskForPermissionFacade(s,a):function(){y._showCachedInterstitial(s,a,c,l,u)},i=JSON.parse(decodeURIComponent(e.message.messagecontent)),o=decodeURIComponent(i.html);h.applyModalTrigger(s,o,r),h.dispatchInternalEvent("Preload-Complete")}else d&&d()}function i(e){g.error("Error getting interstitial.",e),s.onError&&s.onError(e)}var e=h.getStoredValue("OL-Content-"+a);if(e)v.trace(s,"preload.preloadInterstitial","info","No need to preload. Cached interstitial content found."),r(JSON.parse(e));else if(p){var o=f("./push.js");o.isPushSupported(s,function(e){e&&o.getNotificationPermission(s,function(t){v.trace(s,"preload.preloadInterstitial","info","Checking web push permissions before soft opt-in preload: permission = "+t),o.isSubscribedToPush(s,function(e){e||"denied"===t?v.trace(s,"preload.preloadInterstitial","info","Not executing soft opt-in preload: isSubscribed = "+e+"; permission = "+t):(v.trace(s,"preload.preloadInterstitial","info","Executing soft opt-in HTTP call: isSubscribed = "+e+"; permission = "+t),y._makePreloadHttpRequest(s,a,n,r,i))})})})}else v.trace(s,"preload.preloadInterstitial","info","Executing standard interstitial HTTP call."),y._makePreloadHttpRequest(s,a,n,r,i)},preloadInterstitials:function(e){var t=y._getPlacements(e);if(t){var n=t.indexOf(b);-1<n&&(t=t.splice(n,1).concat(t));var r=t.splice("2");for(var i in 0<r.length&&g.warn('The number of valid placements in "preloadContent" exceeds the preload limit of 2. The following placements will not be preloaded: '+r.join(", ")),t)y._preloadInterstitial(e,t[i])}},clearCachedInterstitials:function(e,t){v.trace(e,"preload.clearCachedInterstitials","info","Clearing cached interstitials.");for(var n=0;n<i.length;n++)h.clearStoredValue("OL-Content-"+i[n]);t&&t()},_getPlacements:function(e){var n=[],t=!0===e.preloadContent?[b]:r.isArray(e.preloadContent)?r.filter(e.preloadContent,function(e){var t=r.contains(i,e);return t||n.push(e),t}):null;return 0<n.length&&g.warn('Invalid "preloadContent" placement(s): '+n.join(", ")),t},_hasCachedInterstitial:function(e,t){var n=h.getStoredValue("OL-Content-"+t);return v.trace(e,"preload.hasCachedInterstitial","info","Cached interstitial "+(n?"exists":"does not exist")+" for placement: "+t),null!==n},hasCachedInterstitials:function(e){var t=y._getPlacements(e);for(var n in t)if(!y._hasCachedInterstitial(e,t[n]))return!1;return null!==t&&0<t.length}};e.exports={hasCachedInterstitial:y._hasCachedInterstitial,hasCachedInterstitials:y.hasCachedInterstitials,clearCachedInterstitials:y.clearCachedInterstitials,preloadInterstitial:y._preloadInterstitial,preloadInterstitials:y.preloadInterstitials,markInterstitialAsDisplayed:y.markInterstitialAsDisplayed}},{"../platform/":24,"../platform/browser/xhr-queue.js":22,"../utils/":40,"../utils/facade.js":39,"./event.js":26,"./logging.js":27,"./push.js":31,"./session.js":33,"./tracing.js":35,"./tracking.js":36,underscore:3}],31:[function(e,t,n){var r,i,g=e("./logging.js"),u=e("../platform/"),h=e("./tracking.js"),m=e("../utils/"),v=e("../platform/browser/xhr-queue.js"),s=m.Promise;function c(n){return u.push.isHttpWebPushSupported().then(function(e){if(!n.crossOriginReceiverUrl||e)return u.push;if(!r){var t=n.crossOriginReceiverUrl;void 0!==n.tracingEnabled&&(t=m.updateUrlParameter(t,"tracingEnabled",n.tracingEnabled)),n.trace("push.configure","info","Web push subscription is managed on another domain. Loading remote page to communicate to in a hidden iframe.",t),r=u.iframeProxy.proxySenderObject(u.push,t,"push")}return r})}function b(n,r,i){return new s(function(e,t){i.onSuccess=e,i.onError=t,n.call(v,r,i)})}var o={isPushSupported:function(t,n){n=n||function(){},c(t).then(function(e){return e.isSupported()}).then(n,function(e){t.onError(e),n()})},subscribeToPush:function(e,t){if(e.subscriptionRetryCount||(e.subscriptionRetryCount=0),!e.vapidMigrationRunning||5<e.subscriptionRetryCount)e.trace("push.subscribeToPush","info","migration not running or retry limit exceeded. Proceeding with subscription"),o=(o=t)||function(){},c(i=e).then(function(r){i.trace("push.subscribe","info","Subscribing to push"),r.subscribe(i).then(function(t){var e=i.server.deliverabilityEndpoint+"/deliverability/appkey/"+i.data.app_key+"/trackingid/"+h.getTrackingId(i)+"/messagetype/browserpush",n={messageType:"browserpush",deliveryDetails:t};return i.trace("push.delivery-details","info","Sending delivery details to the API",{url:e,payload:n}),b(v.dispatchPutRequest,e,{data:n,asJson:!0}).then(function(e){return i.trace("push.delivery-details","info","Delivery details updated with the API",{response:e}),r.saveSubscriptionDetails(i,t).then(function(){return e})})}).then(o,function(e){i.onError&&i.onError(e),i.trace("push.subscribe","error","Error occurred while subscribing to push",{error:e.message||e}),o()})});else{e.trace("push.subscribeToPush","info","waiting on migration routine. retry "+e.subscriptionRetryCount),e.subscriptionRetryCount=e.subscriptionRetryCount+1;var n=this;setTimeout(function(){n.subscribeToPush(e,t)},1e3)}var i,o},unsubscribeFromPush:function(o,t){t=t||function(){},c(o).then(function(i){return o.trace("push.unsubscribe","info","Unsubscribing from push"),s.all([i.requiresDeliverabilityDelete(),i.unsubscribe(o)]).then(function(e){var t=e[0],n=e[1];if(t){if(n){var r=o.server.deliverabilityEndpoint+"/deliverability/appkey/"+o.data.app_key+"/trackingid/"+h.getTrackingId(o)+"/messagetype/browserpush";return o.trace("push.unsubscribe.remove-details","info","Removing delivery details for the tracking ID"),b(v.dispatchDeleteRequest,r,{asJson:!0}).then(function(){return i.removeSubscriptionDetails(o)})}o.trace("push.unsubscribe.no-subscription-endpoint","info","Unsubscribe did not return a subscription endpoint")}else o.trace("push.unsubscribe.remove-details","info","Not removing delivery details because it is done by the browser on this platform")}).then(t,function(e){o.onError&&o.onError(e),o.trace("push.unsubscribe","error","Error occurred while unsubscribing from push",{error:e.message}),t()})})},isSubscribedToPush:function(t,n){n=n||function(){},c(t).then(function(e){e.isSubscribed(t).then(function(e){t.trace("push.is-subscribed","info","Checked if subscribed to push: "+e,{subscribed:e}),n(e)},function(e){t.trace("push.is-subscribed","error","Error occurred while checking if subscribed to push",{error:e.message}),t.onError(e),n()})})},getNotificationPermission:function(t,n){n=n||function(){},c(t).then(function(e){e.getNotificationPermission(t).then(function(e){t.trace("push.permissions","info","Got notification permissions",e),n(e)},function(e){t.trace("push.permissions","error","Error while getting notification permissions",{error:e.message||e,stack:e.stack}),t.onError&&t.onError(e),n()})})},getLastNotificationPhash:function(n,t){var r;t=t||function(){},c(n).then(function(e){return(r=e).isSupported()}).then(function(e){if(e)return r.getLastPushMessage()}).then(function(e){if(e){var t;g.info("Found last browser push message. Extracting phash."),g.debug("Last browser push message is ",e);try{t=JSON.parse(e)}catch(e){g.warn("Could not parse last push message: ",e.stack)}if(t&&t.phash)return n.trace("push.notification-phash","info","Found phash from the last web push notification",t.phash),g.info("Extracted phash: "+t.phash),t.phash}}).then(t,function(e){n.onError&&e&&n.onError(e),t()})},setUpRemoteReceiver:function(){i=i||u.iframeProxy.proxyReceiverObject(u.push,"push")},updateTrackingId:function(r,e,i,t){t=t||function(){};var n=r.server.deliverabilityEndpoint+"/deliverability/appkey/"+r.data.app_key+"/trackingid/"+e+"/messagetype/browserpush/renameTrackingId?platform="+u.getBrowserName(),o={newTrackingId:i};r.trace("push.delivery-details","info","Updating tracking ID for delivery details",{old:e,new:i}),s.all([c(r),b(v.dispatchPostRequest,n,{data:o,asJson:!0})]).then(function(e){var t=e[0],n=e[1];return r.trace("push.delivery-details","info","Updated tracking ID for delivery details",{response:n}),t.saveRecipientDetails(r.data.app_key,i)}).then(t,function(e){r.trace("push.delivery-details","error","Could not save recipient details",{error:e.message}),r.onError&&r.onError(e),t()})},updateDeliverabilityStatus:function(p,e){var f,t=e||function(){};c(p).then(function(e){return(f=e).isSupported()}).then(function(e){if(e)return s.all([f.getNotificationPermission(p),f.isSubscribed(p),f.getSubscriptionDetails(p)]).then(function(e){var t=e[0],n=e[1],r=e[2],i=!!r,o="granted"!==t,s="granted"===t&&!n,a=p.multipleSubdomains,u=m.getHostname()===p.primarySubdomain,c=p.isUsingHttpSolution;if(i&&(o||s)&&(!a||a&&u||a&&c)){p.trace("push.update-deliverability-status","info","Tracking ID no longer deliverable - requesting deliverability deletion.",{subscription:r,permission:t,isSubscribed:n,subscriptionIsPresent:i,permissionsAreNotGranted:o,permissionsAreGrantedButNotSubscribed:s,isMultiSubdomain:a,isPrimarySubdomain:u,isUsingHttpSolution:c});var l=p.server.deliverabilityEndpoint+"/deliverability/appkey/"+p.data.app_key+"/trackingid/"+h.getTrackingId(p)+"/messagetype/browserpush/subscription",d=r;return b(v.dispatchDeleteRequest,l,{data:d,asJson:!0}).then(f.removeSubscriptionDetails).then(function(){g.info("Set as undeliverable: Tracking ID: "+h.getTrackingId(p)+" subscription: ",r),p.trace("push.update-deliverability-status","info","Has been set as undeliverable",{trackingId:h.getTrackingId(p),subscription:r,triggerConditions:{subscriptionIsPresent:i,permissionsAreNotGranted:o,permissionsAreGrantedButNotSubscribed:s}})})}})}).then(t,function(e){p.onError&&p.onError(e),t()})},migrateSubscription:function(s){var a;s.vapidMigrationRunning=!0,s.trace("push.migrateSubscription","info","Executing migration routine"),s.vapidPublicKey?c(s).then(function(e){return(a=e).supportsVAPIDWebPush()&&a.isSupported()}).then(function(e){return s.trace("push.migrateSubscription","info","push is supported: "+e),!!e&&a.isSubscribed(s)}).then(function(e){e?(s.trace("push.migrateSubscription","info","push is subscribed: "+e),a.getCurrentDeliveryDetails(s).then(function(r){var e,t,n,i,o;s.trace("push.migrateSubscription","info","retrieved current delivery details: "+JSON.stringify(r)),e=r,n=function(e){s.trace("push.migrateSubscription","info","is VAPID status: "+JSON.stringify(e.response)),!0!==e.response?a.unsubscribe(s).then(function(e){s.trace("push.migrateSubscription","info","executed unsubscribe for non vapid subscription: "),e?(s.trace("push.migrateSubscription","info","successfully unsubscribed"),a.subscribe(s).then(function(e){if(s.trace("push.migrateSubscription","info","executed subscribe using vapid key: "+JSON.stringify(e)),e){r.isVapid=!1,e.isVapid=!0;var t=s.server.deliverabilityEndpoint+"/deliverability/appkey/"+s.data.app_key+"/trackingid/"+h.getTrackingId(s)+"/messagetype/browserpush/migrate",n={oldDeliveryDetails:{messageType:"browserpush",deliveryDetails:r},newDeliveryDetails:{messageType:"browserpush",deliveryDetails:e}};return s.trace("push.migrateSubscription","info","sending migration request to deliverability API: "+t),u.setStoredValue("OL_VAPID_migration_on",(new Date).getTime()),s.vapidMigrationRunning=!1,b(v.dispatchPostRequest,t,{data:n,asJson:!0})}s.vapidMigrationRunning=!1,s.trace("push.migrate.subscribe","info","failed to create new VAPID key subscription.")})):(s.vapidMigrationRunning=!1,s.trace("push.migrate.unsubscribe","info","failed to unsubscribe existing subscription."))}):(s.vapidMigrationRunning=!1,s.trace("push.migrate","info","already a VAPID subscription. No action needed."))},i=(t=s).server.deliverabilityEndpoint+"/deliverability/appkey/"+t.data.app_key+"/trackingid/"+h.getTrackingId(t)+"/messagetype/browserpush/vapidstatus",o={messageType:"browserpush",deliveryDetails:e},t.trace("push.migrateSubscription","info","requesting isVapid status check from deliverability API: "+i),v.dispatchPostRequest(i,{data:o,asJson:!0,onSuccess:n,onError:t.onError})})):(s.vapidMigrationRunning=!1,s.trace("push.migrate","info","not subscribed to web push. No action needed."))}):(s.vapidMigrationRunning=!1,s.trace("push.migrate","info","No VAPID key is configured."))},readServiceWorkerTraceEvents:function(e){return c(e).then(function(e){return e.readTraceEvents()})},getServiceWorkerConfig:function(e){return c(e).then(function(e){return e.getServiceWorkerConfig()})},peekLastPushMessage:function(e){return c(e).then(function(e){return e.peekLastPushMessage()})}};t.exports={migrateSubscription:o.migrateSubscription,isPushSupported:o.isPushSupported,subscribeToPush:o.subscribeToPush,unsubscribeFromPush:o.unsubscribeFromPush,isSubscribedToPush:o.isSubscribedToPush,getNotificationPermission:o.getNotificationPermission,getLastNotificationPhash:o.getLastNotificationPhash,peekLastPushMessage:o.peekLastPushMessage,setUpRemoteReceiver:o.setUpRemoteReceiver,updateTrackingId:o.updateTrackingId,updateDeliverabilityStatus:o.updateDeliverabilityStatus,readServiceWorkerTraceEvents:o.readServiceWorkerTraceEvents,getServiceWorkerConfig:o.getServiceWorkerConfig}},{"../platform/":24,"../platform/browser/xhr-queue.js":22,"../utils/":40,"./logging.js":27,"./tracking.js":36}],32:[function(u,e,t){var l=u("./logging.js"),d=u("./event.js"),p=u("./tracking.js"),f=u("../platform/browser/xhr-queue.js"),g={_expirationCheckTimeout:void 0,_messages:[],_meta:{total:0,unread:0},_onMessagesUpdatedCallback:void 0,_maxDelay:Math.pow(2,31)-1,_lastDisplayGroupUsed:void 0,_checkDisplayGroup:function(e,t){t!==g._lastDisplayGroupUsed&&(g._lastDisplayGroupUsed=t,0<g._messages.length&&g.clear(e))},_messagesSorter:function(e,t){return e.delivered_at>t.delivered_at||!(e.delivered_at<t.delivered_at)&&e.id>t.id?-1:1},_syncServer:function(e,t,n){var r=e.server.rimsEndpoint+"/"+e.data.app_key+"/"+p.getTrackingId(e)+"/rich/mailbox";t&&void 0!==t.displayGroup&&!isNaN(parseInt(t.displayGroup,10))?(r+="?displayGroup="+t.displayGroup,r+="&"):r+="?",r+="stateHash=";var i="";!function t(){f.dispatchGetRequest(r+i,{onSuccess:function(e){e?e.synchronisation_complete?n():(i=e.state_hash,setTimeout(t)):n(new Error("response is empty"))},onError:n})}()},_removeExpired:function(){for(var e=[],t=[],n=0,r=(new Date).getTime()/1e3,i=0;i<g._messages.length;i++){var o=g._messages[i];void 0!==o.end&&o.end<=r?(t.push(o),o.read||n++):e.push(o)}if(g._messages=e,g._meta.total-=t.length,g._meta.unread-=n,g._meta.total<g._messages.length){g._meta.total=g._messages.length;var s=0;for(i=0;i<g._messages.length;i++)s+=g._messages[i].read?0:1;g._meta.unread=s}l.debug("RIMS expired ",t.length+" messages."),0<t.length&&g._onMessagesUpdatedCallback&&g._onMessagesUpdatedCallback(g._messages,[],[],t,g._meta),g.scheduleExpirationCheck()},scheduleExpirationCheck:function(){var e;void 0!==g._expirationCheckTimeout&&(clearTimeout(g._expirationCheckTimeout),g._expirationCheckTimeout=void 0);for(var t=0;t<g._messages.length;t++){var n=g._messages[t];void 0!==n.end&&void 0===e&&(e=n.end),void 0!==n.end&&n.end<e&&(e=n.end)}if(void 0!==e){var r=e-(new Date).getTime()/1e3;r=r<0?0:r,g._meta.total<g._messages.length&&(r=0);var i=1e3*r;i=i>g._maxDelay?g._maxDelay:i,l.debug("RIMS expiration check in "+i/1e3+" sec"),g._expirationCheckTimeout=setTimeout(g._removeExpired,i)}},onMessagesUpdated:function(e,t){g._onMessagesUpdatedCallback=t},getNewMessages:function(n,e,r){var t=n.server.rimsEndpoint+"/"+n.data.app_key+"/"+p.getTrackingId(n)+"/rich/mailbox/messages",i=[];e&&void 0!==e.displayGroup&&!isNaN(parseInt(e.displayGroup,10))?(i.push(["displayGroup",e.displayGroup]),g._checkDisplayGroup(n,e.displayGroup)):g._checkDisplayGroup(n),0===g._messages.length?e&&e.limit&&i.push(["limit",e.limit]):i.push(["newerThan",g._messages[0].delivered_at]);for(var o=0;o<i.length;o++){var s=i[o];t+=(0===o?"?":"&")+s[0]+"="+s[1]}function a(e){if(e&&void 0!==e.items&&e.meta){if(l.info("Received "+e.items.length+" messages in rich inbox"),e.items){e.items.sort(g._messagesSorter);for(var t=0;t<e.items.length;t++)e.items[t].content&&(e.items[t].content=decodeURIComponent(e.items[t].content));g._messages=e.items.concat(g._messages)}g._meta={total:e.meta.total,unread:e.meta.unread},r&&r(e.items,g._meta),g._onMessagesUpdatedCallback&&g._onMessagesUpdatedCallback(g._messages,e.items,[],[],g._meta),g.scheduleExpirationCheck()}else n.onError&&n.onError(new Error("Malformed response from the Rich Inbox endpoint"))}function u(e){l.error("Error getting Rich Inbox messages",e),n.onError&&n.onError(e),g.scheduleExpirationCheck()}g._syncServer(n,e,function(e){e?u(e):f.dispatchGetRequest(t,{onSuccess:a,onError:u})})},getMoreMessages:function(n,e,r){if(0===g._messages.length)return g.getNewMessages(n,e,r);var t=n.server.rimsEndpoint+"/"+n.data.app_key+"/"+p.getTrackingId(n)+"/rich/mailbox/messages",i=[];e&&void 0!==e.displayGroup?(i.push(["displayGroup",e.displayGroup]),g._checkDisplayGroup(n,e.displayGroup)):g._checkDisplayGroup(n),0<g._messages.length&&i.push(["olderThan",g._messages[g._messages.length-1].delivered_at]);for(var o=0;o<i.length;o++){var s=i[o];t+=(0===o?"?":"&")+s[0]+"="+s[1]}f.dispatchGetRequest(t,{onSuccess:function(e){if(e&&void 0!==e.items&&e.meta){if(l.info("Received "+e.items.length+" messages in rich inbox"),e.items){e.items.sort(g._messagesSorter);for(var t=0;t<e.items.length;t++)e.items[t].content&&(e.items[t].content=decodeURIComponent(e.items[t].content));g._messages=g._messages.concat(e.items)}g._meta={total:e.meta.total,unread:e.meta.unread},r&&r(e.items,g._meta),g._onMessagesUpdatedCallback&&g._onMessagesUpdatedCallback(g._messages,e.items,[],[],g._meta),g.scheduleExpirationCheck()}else n.onError&&n.onError(new Error("Malformed response from the Rich Inbox endpoint"))},onError:function(e){l.error("Error getting Rich Inbox messages",e),n.onError&&n.onError(e),g.scheduleExpirationCheck()}})},getMessages:function(e,t){t&&t(g._messages,g._meta)},markAsRead:function(a,u,c){var e=a.server.rimsEndpoint+"/"+a.data.app_key+"/"+p.getTrackingId(a)+"/rich/mailbox/messages/"+u;f.dispatchPutRequest(e,{data:{read:!0},asJson:!0,onSuccess:function(){for(var e,t=!1,n=0;n<g._messages.length;n++){var r=g._messages[n];if(r.id===u){t=1===r.read,r.read=1,e=r,t||g._meta.unread--;break}}var i=t?"Re-Read":"Read",o=t?"Rich Message "+u+" Re-Read":"Rich Message "+u+" Opened";if(d.registerEvent(a,i,o,null,e?e.phash:void 0),l.info("Marked message "+u+" as "+i+"."),c&&c(e),g._onMessagesUpdatedCallback){var s=[];e&&s.push(e),g._onMessagesUpdatedCallback(g._messages,[],s,[],g._meta)}g.scheduleExpirationCheck()},onError:function(e){l.error("Error marking Rich Inbox message as read",e),a.onError&&a.onError(e),g.scheduleExpirationCheck()}})},markAsDeleted:function(o,s,a){var e=o.server.rimsEndpoint+"/"+o.data.app_key+"/"+p.getTrackingId(o)+"/rich/mailbox/messages/"+s;f.dispatchPutRequest(e,{data:{deleted:!0},asJson:!0,onSuccess:function(){for(var e,t=0;t<g._messages.length;t++){var n=g._messages[t];if(n.id===s){e=n,g._meta.total--,n.read||g._meta.unread--;break}}if(e){var r=u("../utils/");g._messages=r.arrayRemove(g._messages,e)}if(d.registerEvent(o,"Delete","Rich Message "+s+" Deleted",null,e?e.phash:void 0),l.info("Marked message "+s+" as deleted."),a&&a(e),g._onMessagesUpdatedCallback){var i=[];e&&i.push(e),g._onMessagesUpdatedCallback(g._messages,[],[],i,g._meta)}g.scheduleExpirationCheck()},onError:function(e){l.error("Error marking Rich Inbox message as deleted",e),o.onError&&o.onError(e),g.scheduleExpirationCheck()}})},setMessages:function(e,t){g._messages=t||[];for(var n=0,r=0;r<g._messages.length;r++)g._messages[r].read||n++;g._meta={total:g._messages.length,unread:n}},clear:function(e){l.logLevel=e.logLevel;var t=g._messages;g._messages=[],g._meta={total:0,unread:0},g._onMessagesUpdatedCallback&&g._onMessagesUpdatedCallback(g._messages,[],[],t,g._meta),l.debug("Cleared RIMS messages")},_clearLastDisplayGroupUsed:function(){g._lastDisplayGroupUsed=void 0}};e.exports={getNewMessages:g.getNewMessages,getMoreMessages:g.getMoreMessages,getMessages:g.getMessages,onMessagesUpdated:g.onMessagesUpdated,setMessages:g.setMessages,markAsRead:g.markAsRead,markAsDeleted:g.markAsDeleted,clear:g.clear,_clearLastDisplayGroupUsed:g._clearLastDisplayGroupUsed}},{"../platform/browser/xhr-queue.js":22,"../utils/":40,"./event.js":26,"./logging.js":27,"./tracking.js":36}],33:[function(e,t,n){var v=e("./logging.js"),b=e("../platform/"),y=e("../utils/"),_=e("./push.js"),w=e("./tracing.js"),S=e("./tracking.js"),k=e("../platform/browser/xhr-queue.js"),E={startSession:function(t,n){_.getLastNotificationPhash(t,function(e){v.debug("Checking for a phash",e),e&&v.debug("phash "+e+" found"),E.startSessionWithPhash(t,e,n)})},startSessionWithPhash:function(r,e,t){w.trace(r,"session.startSessionWithPhash","info","Push phash value is "+e,e),E._sessionRefreshInterval&&(clearInterval(E._sessionRefreshInterval),E._sessionRefreshInterval=null);var n,i,o,s=b.getStoredValue("OL_Session_Id"),a=s?b.getStoredValue("OL_Phash"):null;w.trace(r,"session.startSessionWithPhash","info","Stored phash value.",a);var u,c=b.getOLParametersFromQueryString();n=c.sessionId,i=c.trackingId,o=c.phash,i||o||(o=b.getPhashFromHashFragment(r.phashTag)),w.trace(r,"session.startSessionWithPhash","info","URL phash value is "+o,o),o=o||e,n&&u!==n?(u=n,b.setStoredValue("OL_Session_Id",u)):u=s;var l=!u||o&&a!==o;r.data.sid=u&&!l?u:y.generateUUID(),r.data.session_length=0,r.data.average_session_length=0,r.data.phash=o||a,l&&h(r.data.sid,r.data.phash);var d=S.getTrackingId(r);if(i&&d!==i){var p=y.getLongTermExpiry();r.data.prev_tracking_id=d,b.setStoredValue("OL_Prev_Tracking_ID",d,p),r.data.tracking_id=i,b.setStoredValue("OL_Tracking_ID",i,p)}function f(){var e=b.getStoredValue("OL_Session_Id"),t=b.getStoredValue("OL_Phash");E._sessionRefreshInterval&&null===e&&0<r.sessionExpirationSeconds?(clearInterval(E._sessionRefreshInterval),E._sessionRefreshInterval=null,E.startSession(r)):h(e,t)}function g(){!E._sessionRefreshInterval&&0<r.sessionExpirationSeconds&&(E._sessionRefreshInterval=setInterval(f,1e4))}function h(e,t){var n=new Date((new Date).getTime()+1e3*r.sessionExpirationSeconds);v.debug("Setting session expiration on: "+n),0<r.sessionExpirationSeconds?(null!==e&&(r.data.sid=e),w.trace(r,"session.storePhash","info","Storing phash.",t),b.setStoredValue("OL_Session_Id",r.data.sid,n),b.setStoredValue("OL_Phash",t,n)):(w.trace(r,"session.storePhash","info","Clearing session ID and phash."),b.clearStoredValue("OL_Session_Id"),b.clearStoredValue("OL_Phash"))}if(r.sessionStart=(new Date).getTime(),f(),_.updateDeliverabilityStatus(r),v.info("startSession",r.data.sid),l){w.trace(r,"session.start","info","Using new generated session.",r.data.sid),v.debug("new session id: "+r.data.sid+" old session id: "+u+" new tracking id: "+S.getTrackingId(r)+" old tracking id: "+r.data.prev_tracking_id+" new phash: "+r.data.phash+" old phash: "+a);var m=r.server.apiEndpoint+"/session";k.dispatchPostRequest(m,{data:r.data,onSuccess:function(e){w.trace(r,"session.start","info","Session updated with the API.",{endpoint:r.server.apiEndpoint+"/session",response:e}),g(),t&&t(e,l)},onError:function(e){w.trace(r,"session.error","error","Error while sending a session start request to the API",e),r.onError&&r.onError(e)}})}else w.trace(r,"session.continue","info","Reusing stored session",r.data.sid),g(),t&&t(null,l);w.trace(r,"session.ready","info","Phash for session is "+r.data.phash,r.data.phash)},getSessionId:function(e){return e.data.sid},endSession:function(t,n){if(!t.data.sid)return w.trace(t,"session.end","info","endSession called, but no active session found. Ignoring."),void v.info("endSession ignored as no active session");v.info("endSession",t.data.sid),w.trace(t,"session.end","info","Ending session",t.data.sid),t.data.session_length=(new Date).getTime()-(t.sessionStart||0);var e=b.getStoredValue("OL_Session_Count"),r=b.getStoredValue("OL_Total_Session_Length");e&&r?(e=parseInt(e)+1,r=parseInt(r)+t.data.session_length,t.data.average_session_length=Math.ceil(r/e),b.setStoredValue("OL_Session_Count",e,y.getLongTermExpiry()),b.setStoredValue("OL_Total_Session_Length",r,y.getLongTermExpiry())):(t.data.average_session_length=t.data.session_length,b.setStoredValue("OL_Session_Count",1,y.getLongTermExpiry()),b.setStoredValue("OL_Total_Session_Length",t.data.session_length,y.getLongTermExpiry()));var i=t.server.apiEndpoint+"/session/end";k.dispatchPostRequest(i,{data:t.data,onSuccess:function(e){delete t.data.sid,delete t.data.phash,delete t.data.prev_tracking_id,b.setStoredValue("OL_Prev_Tracking_ID",null),clearInterval(E._sessionRefreshInterval),b.setStoredValue("OL_Session_Id",null),b.setStoredValue("OL_Phash",null),n&&n(e)},onError:t.onError})},setPhash:function(e,t){e.data.phash=t;var n=new Date((new Date).getTime()+1e3*e.sessionExpirationSeconds);w.trace(e,"session.set-phash","info","Setting phash.",e.data.phash),b.setStoredValue("OL_Phash",e.data.phash,n)}};t.exports={startSession:E.startSession,getSessionId:E.getSessionId,endSession:E.endSession,setPhash:E.setPhash}},{"../platform/":24,"../platform/browser/xhr-queue.js":22,"../utils/":40,"./logging.js":27,"./push.js":31,"./tracing.js":35,"./tracking.js":36}],34:[function(e,t,n){var a=e("./logging.js"),u=e("./tracking.js"),c=e("../platform/browser/xhr-queue.js"),r={setTag:function(e,t,n,r,i){a.info("setTag",t,n,r);var o={trackingid:u.getTrackingId(e),appkey:e.data.app_key,name:t,type:r,value:n},s=e.server.tagsEndpoint+"/";c.dispatchPostRequest(s,{data:o,asJson:!0,onSuccess:i,onError:e.onError})},batchSetTag:function(e,t,n){a.info("setTags",t);var r={trackingid:u.getTrackingId(e),appkey:e.data.app_key,tags:t},i=e.server.tagsEndpoint+"/";c.dispatchPostRequest(i,{data:r,asJson:!0,onSuccess:n,onError:e.onError})},getTag:function(e,t,n){var r=e.server.tagsEndpoint+"/apps/"+e.data.app_key+"/tracking/"+u.getTrackingId(e)+"/tag/"+t;c.dispatchGetRequest(r,{onSuccess:n,onError:e.onError})}};t.exports={setTag:r.setTag,getTag:r.getTag,batchSetTag:r.batchSetTag}},{"../platform/browser/xhr-queue.js":22,"./logging.js":27,"./tracking.js":36}],35:[function(e,t,n){var r=e("../platform/index.js"),o=e("../utils/index.js"),s=e("./logging.js"),i=e("../utils/browserpush.js"),a=e("./push.js"),u=r.push,c=o.Promise,l="OL_WEB_DEVICE_ID";function d(e,t){return e.timestamp-t.timestamp}var p={_lastEventTimestamp:void 0,_traceCache:[],_traceDb:null,_getTraceDB:function(){return!p._traceDb&&i.isIndexedDBSupported()&&(p._traceDb=new i.IndexedDBWrapper("ol-jssdk-trace-events",1,{autoIncrement:!0})),p._traceDb},_addToCache:function(e){var t=p._getTraceDB();return t?t.add(JSON.stringify(e)).then(function(){},function(e){s.error("Could not add trace event to IndexedDB: "+e.message)}):(p._traceCache.push(e),c.resolve())},_getCachedItems:function(){var e=p._getTraceDB();return e?e.getAll().then(function(e){return e.map(function(e){return JSON.parse(e)})}):c.resolve(p._traceCache.concat([]))},_clearCachedItems:function(){var e=p._getTraceDB();return e?e.clear().catch(function(e){s.error("Could not remove trace event from IndexedDB: "+e.message)}):(p._traceCache.splice(0,p._traceCache.length),c.resolve())},_outputTraceEvents:function(e){e.forEach(function(e){var t=new Date(e.timestamp),n="["+e.tag+"] "+t+" : "+e.description;s.trace(n,e.meta)}),0<e.length&&(p._lastEventTimestamp=e[e.length-1].timestamp)},_traceOutputPoller:function(e){p.readCachedTraceEvents(e,{afterTimestamp:p._lastEventTimestamp}).then(function(e){e&&p._outputTraceEvents(e)}),p._tracerEnabled&&setTimeout(function(){p._traceOutputPoller(e)},1e3)},enableTracing:function(e){return p._setUpTracingId().then(function(){p._tracerEnabled=!0,p._lastEventTimestamp=(new Date).getTime(),p._traceOutputPoller(e)},function(e){s.error("Unexpected error while enabling tracing: "+e.message),p._tracerEnabled=!0})},disableTracing:function(){return p._tracerEnabled=!1,u.isSupported().then(function(e){if(e)return u.setTracingDisabled().then(void 0,function(e){s.error("Could not remove tracer enabled key for web push worker: "+e.message)})},function(e){s.error("Could not get web push support information because of error: "+e.message)})},clearTraceEvents:function(){return u.isSupported().then(function(e){return(e?u.clearTraceEvents():c.resolve()).then(p._clearCachedItems,function(e){return s.error("Could not clear trace events from worker: "+e.message),p._clearCachedItems()})},function(e){s.error("Could not get web push support information because of error: "+e.message)})},trace:function(e,t,n,r,i){if(!p._tracerEnabled)return c.resolve();var o,s=(new Date).getTime();try{o=JSON.parse(JSON.stringify(void 0===i?{}:i))}catch(e){o="[could not convert to JSON]"}return p._addToCache({webDeviceId:p._tracingId,timestamp:s,tag:t,severity:n,description:r,meta:o})},readCachedTraceEvents:function(e,t){var i=t&&t.afterTimestamp?t.afterTimestamp:0,n=a.readServiceWorkerTraceEvents(e).then(void 0,function(e){return s.error("Could not read events from push worker: "+e.message),[]}),r=p._getCachedItems().then(void 0,function(e){return s.error("Could not read cached events: "+e.message),[]});return c.all([n,r]).then(function(e){var t,n=e[0],r=e[1].concat(n);return r.sort(d),r=o.filter(r,(t=i,function(e){return e&&e.timestamp&&e.timestamp>t}))})},_setUpTracingId:function(){var t=r.getStoredValue(l);return t||(t=o.generateUUID(),r.setStoredValue(l,t,o.getLongTermExpiry())),p._tracingId=t,o.isHTTPS()||o.isLocalhost()?(s.debug("Setting up tracing for push"),u.isSupported().then(function(e){if(e)return u.setTracingId(t).then(function(){return u.setTracingEnabled().then(void 0,function(e){s.error("Could not set tracer enabled key for web push worker: "+e.message)})},function(e){s.error("Could not set tracer tracingId for web push worker: "+e.message)})},function(e){s.error("Could not get web push support information because of error: "+e.message)})):(s.debug("Not setting up tracing for push because the page is not loaded via HTTPS"),c.resolve())}};t.exports={trace:p.trace,enableTracing:p.enableTracing,disableTracing:p.disableTracing,readCachedTraceEvents:p.readCachedTraceEvents,clearTraceEvents:p.clearTraceEvents}},{"../platform/index.js":24,"../utils/browserpush.js":38,"../utils/index.js":40,"./logging.js":27,"./push.js":31}],36:[function(a,e,t){var u=a("../platform/"),c={getTrackingId:function(e){return u.getStoredValue("OL_Tracking_ID")||e&&e.data.tracking_id},setTrackingId:function(e,t,n){a("./logging.js").info("setTrackingId",t);var r=c.getTrackingId(e);e.data.prev_tracking_id=r;var i=a("../utils/");u.setStoredValue("OL_Prev_Tracking_ID",r,i.getLongTermExpiry()),e.data.tracking_id=t,u.setStoredValue("OL_Tracking_ID",t,i.getLongTermExpiry()),a("./tracing.js").trace(e,"tracking.setTrackingId","info","Set tracking ID.",{old:r,new:t});var o=a("../platform/browser/xhr-queue.js"),s=e.server.apiEndpoint+"/session/tracking_id";o.dispatchPostRequest(s,{data:e.data,onSuccess:n,onError:e.onError})}};e.exports={getTrackingId:c.getTrackingId,setTrackingId:c.setTrackingId}},{"../platform/":24,"../platform/browser/xhr-queue.js":22,"../utils/":40,"./logging.js":27,"./tracing.js":35}],37:[function(g,e,t){var h={apiEndpoint:"https://js-api.otherlevels.com/0.8",tagsEndpoint:"https://js-tags.otherlevels.com/api",mdnEndpoint:"https://js-mdn.otherlevels.com",contentEndpoint:"https://js-content.otherlevels.com",rimsEndpoint:"https://js-rich.otherlevels.com",deliverabilityEndpoint:"https://js-deliverability-api.otherlevels.com",jsSdkService:"https://safari.otherlevels.com"},m="BIfsGYuumnRghw7hMmCxXDZagNQf511WrZXAFOYkUITWBRnEuN6jvD_PBWtADG2nIu_kIy6zR6eVDBuos09HhfY",v={chrome:"width=450,height=250,location=0,status=0,top=0",default:"width=530,height=270,location=0,status=0,top=0"},n={refreshSettings:function(e,t,n,r){var i=g("underscore"),o=g("../platform"),s=g("../services/logging"),a=g("../utils"),u=g("../services/tracing");(null==m||0<=m.indexOf("<js-sdk-service"))&&(m=void 0),n=n||{},r=r||{};var c=v[o.getBrowserName()];c=c||v.default;var l=a.extend(r.data||{},{app_key:t,app_name:n.appName||"(unknown)",lv:e});a.extend(r,{data:l,server:h,multipleSubdomains:n.multipleSubdomains,primarySubdomain:n.primarySubdomain,dataMigrationSubdomain:n.dataMigrationSubdomain,vapidPublicKey:n.vapidPublicKey||m,logLevel:n.logLevel||s.LOG_LEVELS.warn,android:{isFirstLaunch:!0,activityCount:0},sessionExpirationSeconds:void 0===n.sessionExpiration?900:n.sessionExpiration,onError:n.onError||void 0,popupOptions:n.popupOptions||c,permissionUrls:{notificationYes:n.notificationYesUrl||void 0},permissionSettingsUrls:{chrome:n.chromeSettingsUrl||"https://support.google.com/chrome/answer/3220216?hl=en",firefox:n.firefoxSettingsUrl||"https://support.mozilla.org/en-US/products/firefox"},crossOriginReceiverUrl:n.crossOriginReceiverUrl,isUsingHttpSolution:void 0!==n.crossOriginReceiverUrl,crossOriginReceiverMode:n.crossOriginReceiverMode,safariWebsitePushId:n.safariWebsitePushId,preloadContent:n.preloadContent,serviceWorkerLocation:n.serviceWorkerLocation||"/ol-service-worker.js",tracingEnabled:n.tracingEnabled}),void 0===n.preloadContent||i.isArray(n.preloadContent)||s.warn('Specifying a type other than Array for "preloadContent" has been deprecated. Support for deprecated types may be removed in a future release.'),r.serviceWorkerScope=a.getServiceWorkerScopeFromLocation(r.serviceWorkerLocation),n.phashTag&&(r.phashTag=n.phashTag),s.logLevel=r.logLevel;var d=a.getLongTermExpiry();if(r.data.tracking_id=o.getStoredValue("OL_Tracking_ID"),!r.data.tracking_id){var p="@OL@"+a.generateUUID().replace(/-/g,"").substring(4);r.data.tracking_id=p,o.setStoredValue("OL_Tracking_ID",p,d)}o.getStoredValue("OL_Prev_Tracking_ID")&&(r.data.prev_tracking_id=o.getStoredValue("OL_Prev_Tracking_ID")),r.data.lit=o.getStoredValue("OL_LIB_INSTALL_TIME"),r.data.lit||(r.data.lit=""+(new Date).getTime(),o.setStoredValue("OL_LIB_INSTALL_TIME",r.data.lit,d)),r.data.acit=o.getStoredValue("OL_APP_CLEAN_INSTALL_TIME"),r.data.acit||(r.data.acit=""+(new Date).getTime(),o.setStoredValue("OL_APP_CLEAN_INSTALL_TIME",r.data.acit,d)),r.data.session_length=0,r.data.average_session_length=0;var f=o.platformSettings();return a.extend(r,f),"true"!==o.getStoredValue("OL_TraceEnabled")||!1!==r.tracingEnabled&&void 0!==r.tracingEnabled||(r.tracingEnabled=!0),!0===r.tracingEnabled?(u.enableTracing(r),u.trace(r,"tracer.enabled","info","Tracer enabled on page",location)):!1===r.tracingEnabled&&u.disableTracing(r),u.trace(r,"settings.init","info","Settings refreshed",r),r.trace=function(e,t,n,r){return u.trace(this,e,t,n,r)}.bind(r),r.safariWebsitePushId||s.debug("safariWebsitePushId is not defined. Web push will not be available in Safari."),r}};e.exports={refreshSettings:n.refreshSettings}},{"../platform":24,"../services/logging":27,"../services/tracing":35,"../utils":40,underscore:3}],38:[function(e,t,n){var r=new RegExp("(googleapis|/gcm/|/fcm/)","i"),c={isFirefox:function(e){return!r.test(e.endpoint)},isChrome:function(e){return r.test(e.endpoint)},getDeliveryDetails:function(e){if(!e)return{};if(c.isFirefox(e)){var t=e.getKey("p256dh"),n=e.getKey("auth");return{platform:"firefox",subscriptionUrl:e.endpoint,clientKey:btoa(String.fromCharCode.apply(null,new Uint8Array(t))),clientAuth:btoa(String.fromCharCode.apply(null,new Uint8Array(n)))}}if(c.isChrome(e)){var r={platform:"chrome",subscriptionUrl:e.endpoint,p256dh:"",auth:""};if(e.getKey&&e.getKey("p256dh")){var i=e.getKey("p256dh"),o=e.getKey("auth");r.p256dh=btoa(String.fromCharCode.apply(null,new Uint8Array(i))),r.auth=btoa(String.fromCharCode.apply(null,new Uint8Array(o)))}return r}return{}},promisifyIDBRequest:function(o){return new Promise(function(e,t){function n(){e(o.result),i()}function r(){t(o.error),i()}function i(){o.removeEventListener("complete",n),o.removeEventListener("success",n),o.removeEventListener("error",r),o.removeEventListener("abort",r)}o.addEventListener("complete",n),o.addEventListener("success",n),o.addEventListener("error",r),o.addEventListener("abort",r)})},safeToJson:function(e){try{return JSON.stringify(e)}catch(e){return"<could-not-be-presented-as-json>"}},promisedParseJSON:function(t){try{return Promise.resolve(JSON.parse(t))}catch(e){return Promise.reject(new Error('Could not parse string "'+t+'": '+e.message))}},generateMessageId:function(){return"message-"+(new Date).getTime()+"-"+parseInt(1e4*Math.random(),10)},isIndexedDBSupported:function(){return self.indexedDB&&self.IDBObjectStore&&self.IDBObjectStore.prototype.add&&self.IDBObjectStore.prototype.clear&&self.IDBObjectStore.prototype.getAll}};function i(e,t,n){this.dbStoreName=e+"-store";var r=self.indexedDB;if(r){var i=r.open(e,t);this.ready=c.promisifyIDBRequest(i),i.onupgradeneeded=function(){i.result.createObjectStore(this.dbStoreName,n)}.bind(this)}}i.prototype.transaction=function(s,a,u){return this.ready.then(function(e){var t="readonly";a.apply?u=a:a&&(t=a);var n,r=e.transaction(s,t),i=u(r,e),o=c.promisifyIDBRequest(r);return i?(n=i[0]&&"result"in i[0]?Promise.all(i.map(c.promisifyIDBRequest)):c.promisifyIDBRequest(i),o.then(function(){return n})):o})},i.prototype.get=function(t){try{var n=this.dbStoreName;return this.transaction(n,function(e){return e.objectStore(n).get(t)})}catch(e){return Promise.reject(e)}},i.prototype.getAll=function(){try{var t=this.dbStoreName;return this.transaction(t,function(e){return e.objectStore(t).getAll()})}catch(e){return Promise.reject(e)}},i.prototype.add=function(t){try{var n=this.dbStoreName;return this.transaction(n,"readwrite",function(e){e.objectStore(n).add(t)})}catch(e){return Promise.reject(e)}},i.prototype.put=function(t,n){try{var r=this.dbStoreName;return this.transaction(r,"readwrite",function(e){e.objectStore(r).put(n,t)})}catch(e){return Promise.reject(e)}},i.prototype.delete=function(t){try{var n=this.dbStoreName;return this.transaction(n,"readwrite",function(e){e.objectStore(n).delete(t)})}catch(e){return Promise.reject(e)}},i.prototype.clear=function(){try{var t=this.dbStoreName;return this.transaction(t,"readwrite",function(e){e.objectStore(t).clear()})}catch(e){return Promise.reject(e)}},t.exports={getDeliveryDetails:c.getDeliveryDetails,safeToJson:c.safeToJson,promisedParseJSON:c.promisedParseJSON,generateMessageId:c.generateMessageId,IndexedDBWrapper:i,isIndexedDBSupported:c.isIndexedDBSupported,tracingIdStorageKey:"OL_WEB_DEVICE_ID",tracingEnabledKey:"ol_tracing_enabled",traceDbName:"ol-service-worker-trace-events",lastMessageReceivedKey:"last_message_received"}},{}],39:[function(e,t,n){var r=e("../services/permission"),i={getAskForPermissionFacade:function(e,t){var n={placement:t};return function(){r.askForPermission(e,"notification",n,function(){})}}};t.exports={getAskForPermissionFacade:i.getAskForPermissionFacade}},{"../services/permission":29}],40:[function(t,e,n){var r=t("underscore"),i=t("uuid"),o=t("yaku/lib/yaku.core");var s={_Promise:void 0!==window.Promise&&-1!==window.Promise.toString().indexOf("[native code]")?window.Promise:o,generateUUID:function(){return i.v4()},getLongTermExpiry:function(){return new Date((new Date).setFullYear((new Date).getFullYear()+50))},extend:function(e,t){if(null===t||"object"!=typeof t)return t;for(var n in t)t.hasOwnProperty(n)&&("object"!=typeof t[n]||r.isArray(t[n])?e[n]=t[n]:(void 0===e[n]&&(e[n]={}),s.extend(e[n],t[n])));return e},getDeep:function(e,t){for(var n=(t||"").split("."),r=e;void 0!==r&&0!==n.length;){var i=n.shift();try{r=r[i]}catch(e){r=void 0;break}}return r},arrayRemove:function(e,t){if(void 0!==e){var n=s.arrayIndexOf(e,t);if(n<0)return e;var r=e.slice(n+1||e.length);return e.length=n,Array.prototype.push.apply(e,r),e}},arrayIndexOf:function(e,t){if(void 0===e)return-1;for(var n=-1,r=0;r<e.length;r++)if(e[r]===t){n=r;break}return n},forEachInObject:function(e,t){if(void 0!==e)for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},toISOString:function(e){function t(e){return e<10?"0"+e:e}return e.toISOString?e.toISOString():e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},deepCopy:function(e){return JSON.parse(JSON.stringify(e))},updateUrlParameter:function(e,t,n){var r=e.indexOf("#"),i=-1===r?"":e.substr(r);e=-1===r?e:e.substr(0,r);var o=new RegExp("([?&])"+t+"=.*?(&|$)","i"),s=-1!==e.indexOf("?")?"&":"?";return n?e=e.match(o)?e.replace(o,"$1"+t+"="+n+"$2"):e+s+t+"="+n:("?"===(e=e.replace(new RegExp("([?&]?)"+t+"=[^&]*","i"),"")).slice(-1)&&(e=e.slice(0,-1)),-1===e.indexOf("?")&&(e=e.replace(/&/,"?"))),e+i},isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)},filter:function(e,t){if(e.filter)return e.filter(t);for(var n=e.length,r=[],i=0;i<n;i++){var o=e[i];t(o)&&r.push(o)}return r},isHTTPS:function(){try{return/^https/.test(window.location.protocol)}catch(e){return!1}},isLocalhost:function(){try{return"localhost"===window.location.hostname}catch(e){return!1}},getHostname:function(){try{return window.location.hostname}catch(e){return""}},isTopWindow:function(){try{return window.top===window.self}catch(e){return!0}},getPageUrl:function(){try{return window.location.href}catch(e){return"unknown"}},getValidTrackingId:function(e){return"string"==typeof e?e:"number"==typeof e?(t("../services/logging.js").info("v1.10.0 WARNING: OL ID was supplied as number type. Please supply as string type."),e.toString()):void 0},getServiceWorkerScopeFromLocation:function(e,t){if(!e||"string"!=typeof e||!e.trim())return"/";var n=e.trim().replace(/\/$/,"");if(/^\//.test(n))return n.replace(/(.*\/).*/,"$1");var r=(t||window.location.pathname).replace(/(.*\/).*/,"$1");if(/^\.\./.test(n)){var i=n.split("../").length-1,o=r.split("/");return o.slice(0,o.length-i-1).join("/")+"/"}return r},executeWithPromise:function(o){return new s._Promise(function(t,e){var n=!1;function r(e){n||(n=!0,t(e))}var i=o(r);i&&i.then&&"function"==typeof i.then&&i.then(r,e)})},urlBase64ToUint8Array:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new window.Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}};e.exports={generateUUID:s.generateUUID,extend:s.extend,getDeep:s.getDeep,arrayRemove:s.arrayRemove,arrayIndexOf:s.arrayIndexOf,forEachInObject:s.forEachInObject,capitalize:s.capitalize,toISOString:s.toISOString,deepCopy:s.deepCopy,updateUrlParameter:s.updateUrlParameter,isFunction:s.isFunction,filter:s.filter,isHTTPS:s.isHTTPS,isLocalhost:s.isLocalhost,isTopWindow:s.isTopWindow,getPageUrl:s.getPageUrl,getHostname:s.getHostname,getValidTrackingId:s.getValidTrackingId,getLongTermExpiry:s.getLongTermExpiry,getServiceWorkerScopeFromLocation:s.getServiceWorkerScopeFromLocation,Promise:s._Promise,executeWithPromise:s.executeWithPromise,urlBase64ToUint8Array:s.urlBase64ToUint8Array}},{"../services/logging.js":27,underscore:3,uuid:4,"yaku/lib/yaku.core":9}]},{},[10]);